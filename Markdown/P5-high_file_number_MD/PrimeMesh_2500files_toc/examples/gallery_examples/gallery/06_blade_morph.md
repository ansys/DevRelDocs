<!-- DO NOT EDIT. -->
<!-- THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY. -->
<!-- TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE: -->
<!-- "examples\gallery_examples\gallery\06_blade_morph.py" -->
<!-- LINE NUMBERS ARE GIVEN BELOW. -->

<a id="sphx-glr-examples-gallery-examples-gallery-06-blade-morph-py"></a>

<a id="ref-turbine-blade"></a>

# Morphing a hexahedral mesh of a turbine blade to a new shape

**Summary**: This example demonstrates how to morph a structural
hexahedral mesh of a turbine blade to a new deformed shape
defined by a target geometry file.

## Objective

This example appends a CDB mesh with a CAD geometry
and match morphes the mesh to the geometry.

![Turbine blade hexahedral mesh.](images/turbine_blade.png)

## Procedure

* Launch an Ansys Prime Server instance and connect the PyPrimeMesh client.
* Read the mesh and append the new CAD geometry shape.
* Define the mesh source faces and the target geometry faces to match morph.
* Match morph the turbine blade mesh to the new CAD geometry shape.
* Write the mesh for structural analysis.

<!-- GENERATED FROM PYTHON SOURCE LINES 34-39 -->

## Launch Ansys Prime Server

Import all necessary modules.
Launch the Ansys Prime Server instance and connect the client.
Get the client model and instantiate meshing utilities from the `lucid` class.

<!-- GENERATED FROM PYTHON SOURCE LINES 39-50 -->
```default
import os
import tempfile

import ansys.meshing.prime as prime
from ansys.meshing.prime.graphics import Graphics

prime_client = prime.launch_prime()
model = prime_client.model
mesh_util = prime.lucid.Mesh(model=model)
```

```pytb
Traceback (most recent call last):
  File "D:\PyPrimeMesh\doc_test\pyprimemesh\examples\gallery\06_blade_morph.py", line 46, in <module>
    prime_client = prime.launch_prime()
                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\PyPrimeMesh\doc_test\pyprimemesh\src\ansys\meshing\prime\internals\launcher.py", line 242, in launch_prime
    return Client(server_process=server, ip=ip, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\PyPrimeMesh\doc_test\pyprimemesh\src\ansys\meshing\prime\internals\client.py", line 66, in __init__
    self._comm = GRPCCommunicator(
                 ^^^^^^^^^^^^^^^^^
  File "D:\PyPrimeMesh\doc_test\pyprimemesh\src\ansys\meshing\prime\internals\grpc_communicator.py", line 89, in __init__
    raise ConnectionError(
ConnectionError: Failed to connect to Server in given timeout of 20.0 secs
```

<!-- GENERATED FROM PYTHON SOURCE LINES 51-56 -->

## Read files

Download the turbine blade mesh file and CAD geometry.
Read the mesh and append the geometry.
Display the source and the target.

<!-- GENERATED FROM PYTHON SOURCE LINES 56-70 -->
```default
# For Windows OS users, scdoc is also available for geometry:
# target_geometry = prime.examples.download_turbine_blade_target_scdoc()

source_mesh = prime.examples.download_turbine_blade_cdb()
target_geometry = prime.examples.download_deformed_blade_fmd()
mesh_util.read(file_name=source_mesh)
mesh_util.read(file_name=target_geometry, append=True)


display = Graphics(model)
display()
print(model)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 71-73 -->

## Define source and target faces

<!-- GENERATED FROM PYTHON SOURCE LINES 73-79 -->
```default
source_part = model.get_part(2)
target_part = model.get_part(3)
source = source_part.get_face_zonelets()
target = target_part.get_topo_faces()
```

<!-- GENERATED FROM PYTHON SOURCE LINES 80-85 -->

## Match morph mesh

Set the target type to be for topoface because the target is geometry.
Morph the source face zonelets of `source_part` to the
target topo faces of the geometry.

<!-- GENERATED FROM PYTHON SOURCE LINES 85-109 -->
```default
morpher = prime.Morpher(model)
match_pair = prime.MatchPair(
    model=model,
    source_surfaces=source,
    target_surfaces=target,
    target_type=prime.MatchPairTargetType.TOPOFACE,
)

params = prime.MatchMorphParams(model)
bc_params = prime.MorphBCParams(model)
solver_params = prime.MorphSolveParams(model)

morpher.match_morph(
    part_id=source_part.id,
    match_pairs=[match_pair],
    match_morph_params=params,
    bc_params=bc_params,
    solve_params=solver_params,
)

# Display the morphed mesh
display()
```

<!-- GENERATED FROM PYTHON SOURCE LINES 110-114 -->

## Write mesh

Write the morphed CDB file. The geometry is ignored when exporting to a CDB
file.

<!-- GENERATED FROM PYTHON SOURCE LINES 114-121 -->
```default
with tempfile.TemporaryDirectory() as temp_folder:
    mesh_file = os.path.join(temp_folder, "morphed_turbine_blade.cdb")
    mesh_util.write(mesh_file)
    assert os.path.exists(mesh_file)
    print("\nExported file:\n", mesh_file)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 122-124 -->

## Exit PyPrimeMesh

<!-- GENERATED FROM PYTHON SOURCE LINES 124-126 -->
```default
prime_client.exit()
```

**Total running time of the script:** (0 minutes 20.196 seconds)

<a id="sphx-glr-download-examples-gallery-examples-gallery-06-blade-morph-py"></a>
