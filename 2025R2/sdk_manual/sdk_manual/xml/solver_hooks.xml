<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.10.0" xml:lang="en-US">
  <compounddef id="solver_hooks" kind="page">
    <compoundname>solver_hooks</compoundname>
    <title>Solver hooks</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><anchor id="solver_hooks_1md_docs_2sdk__manual_2solver__hooks"/> The Rocky Solver SDK allows users to attach customized C++ code into strategic points of the code that executes a simulation in Rocky. At these points, which are named generically as <ref refid="glossary_1hook" kindref="member">hooks</ref>, the Rocky Solver SDK will provide access to data relevant to the intended operation at that location, and also sometimes the means to send back data to the solver, in order to modify some specific behavior. As an illustration, Figure 3.1 shows the position of the main hooks provided by the Rocky Solver SDK in a very simplified flowchart of a simulation in Rocky.</para>
<para><image type="html" name="hooks_flowchart.png" width="30%"></image>
 <image type="latex" name="hooks_flowchart.png"></image>
 <image type="rtf" name="hooks_flowchart.png"></image>
 <image type="docbook" name="hooks_flowchart.png"></image>
 <image type="xml" name="hooks_flowchart.png"></image>
</para>
<para><emphasis>Figure 3.1: Position of the main hooks provided by the Rocky Solver SDK, relative to the main operations made during a simulation</emphasis></para>
<para>This section describes the hooks a <ref refid="glossary_1module" kindref="member">module</ref> can attach to during a simulation in order to execute custom C++ code. These hooks can be separated broadly into two groups: the ones that are executed only once, when Rocky starts or terminates the simulation, and the ones that are called several times during the simulation, as Rocky updates the state of the particulate system.</para>
<sect2 id="solver_hooks_1autotoc_md29">
<title>Initialization and termination hooks</title><para>The following hooks are called once, when the simulation starts or terminates, as shown in the diagram of Figure 3.1.</para>
<sect3 id="solver_hooks_1autotoc_md30">
<title>ROCKY_PLUGIN_CONFIGURE</title><para>At this point, Rocky parses the configuration settings of external modules. This hook is intended for a module to retrieve the custom input data that was set by the user through the Rocky UI and store it locally for later use. The specifications for custom input data is defined by a module through a Python file, as described in chapter Module Specification.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput>const <ref refid="classIRockyPluginData" kindref="compound">IRockyPluginData</ref> &amp;input_data</computeroutput></para>
<para>Brings all the values of module parameters entered through the Rocky UI. For a description of the available methods for retrieving the values from <computeroutput><ref refid="classIRockyPluginData" kindref="compound">IRockyPluginData</ref></computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *&amp;data</computeroutput></para>
<para>Accepts a generic pointer that is returned back by other hooks. The module may use this pointer to point to a local <computeroutput>struct</computeroutput>, in order to be able to access to custom data in other stages of the simulation.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md31">
<title>ROCKY_PLUGIN_SETUP</title><para>During the setup, Rocky allocates resources that will be needed during the simulation. In this hook, a custom module may allocate memory or other resources for storing custom data.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation. For a list of the methods associated to <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref></computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md32">
<title>ROCKY_PLUGIN_COMPUTE_TIMESTEP</title><para>When a module implements a custom contact force model, it is possible that the model will need a special procedure for the calculation of a stable timestep. If that is the case, this is the hook where that calculation must be implemented. By default, this hook is only called once at the start of the simulation. However, if one wants to force it to be called more than once, the module may invoke <computeroutput><ref refid="structIRockyModel_1ada3d1d7b6e1de1d7e4ef0739a1f4dd8a" kindref="member">IRockyModel::trigger_update_timestep()</ref></computeroutput>. A call to this method (preferably at the <computeroutput>ROCKY_PLUGIN_END_ITERATION</computeroutput> hook) signals to the solver that the timestep needs to be updated at the start of the next iteration.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="classIRockyTimestepData" kindref="compound">IRockyTimestepData</ref> &amp;timestep_data</computeroutput></para>
<para>An object with basic methods for accessing material and materials interactions properties, as well as <ref refid="glossary_1particle-group" kindref="member">particle group</ref> data, to let users implement a stable time step calculation. See chapter <ulink url="annotated.xhtml">Reference</ulink> for a complete description of <computeroutput><ref refid="classIRockyTimestepData" kindref="compound">IRockyTimestepData</ref></computeroutput>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md33">
<title>ROCKY_PLUGIN_COMPUTE_ADHESIVE_DISTANCES</title><para>Deprecated hook. In the current version of the Rocky Solver SDK, <ref refid="glossary_1adhesive-distance" kindref="member">adhesive distance</ref> values can be set within any hook with access to a <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref></computeroutput> object, by using the <computeroutput>set_adhesive_distance</computeroutput> method.</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md34">
<title>ROCKY_PLUGIN_INITIALIZE_PARTICLE</title><para>This hook can be used to initialize particle <ref refid="glossary_1scalar" kindref="member">scalars</ref> with values different from zero (the default value when a scalar variable in Rocky is created). The associated code is executed always in CPU, in a loop over all active particles in the simulation.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticleHost" kindref="compound">IRockyParticleHost</ref> &amp;particle</computeroutput></para>
<para>An active particle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md35">
<title>ROCKY_PLUGIN_INITIALIZE_TRIANGLE</title><para>This hook can be used to initialize triangle <ref refid="glossary_1scalar" kindref="member">scalars</ref> with values different from zero (the default value when a scalar variable in Rocky is created). The associated code is executed always in CPU, in a loop over all geometry triangles in the project.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>IRockyTriangleHost &amp;triangle</computeroutput></para>
<para>A geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md36">
<title>ROCKY_PLUGIN_NON_DIMENSIONALIZE</title><para>Internally, Rocky treats all variables as dimensionless in order to minimize roundoff errors. Therefore, all custom parameters defined in the module must be nondimensionalized at this stage in order to be used correctly during the later calculations.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation. For the nondimensionalization process, this object provides dimensional factors for each one of the fundamental magnitudes and some common derived ones. For a list of all the methods associated to <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md37">
<title>ROCKY_PLUGIN_SETUP_OUTPUT_PROPERTIES</title><para>This hook is intended for the setup of particle and/or geometry triangle properties that a module will deliver to Rocky at output times for visualization and/or post-processing. Within this hook, the data that Rocky will need for displaying each new property must be specified. For instance, the label that will identify the property within the UI, the associated S.I. unit, and a nondimensionalization factor, if necessary.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyOutputPropertyCollection" kindref="compound">IRockyOutputPropertyCollection</ref> &amp;output_property_collection</computeroutput></para>
<para>This is an auxiliary object with methods for setting up custom particle and geometry properties. For a list of all associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md38">
<title>ROCKY_PLUGIN_INITIALIZE</title><para>This hook is placed at the point when Rocky sets the initial state of the simulation. If necessary, the module may use that initial state as a basis to initialize its own custom data.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation. For a list of all the methods associated to <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref></computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md39">
<title>ROCKY_PLUGIN_INITIALIZE_CUDA</title><para>When a simulation must run in single or multi-GPU, Rocky needs to allocate memory and copy the initial state of the simulation to the GPU <ref refid="glossary_1device" kindref="member">devices</ref>. This hook, called for each enabled GPU device, is intended for performing those operations with the custom data of a module.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *host_data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem><listitem><para><computeroutput>int device_id</computeroutput></para>
<para>Identifier of an individual GPU.</para>
</listitem><listitem><para><computeroutput>void *&amp;device_data</computeroutput></para>
<para>Accepts a generic pointer associated to the GPU device identified by <computeroutput>device_id</computeroutput>. The module must ensure in this hook that this pointer will point to a copy of the local <computeroutput>struct</computeroutput> in the GPU device, after allocating memory and performing the copy operation. Rocky will return back this pointer in all the iteration hooks that are executed in GPU, in order to be able to access custom data values at those places.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md40">
<title>ROCKY_PLUGIN_TEAR_DOWN</title><para>When Rocky terminates a simulation, the module has the opportunity in this hook to perform final actions, such as deallocate memory used for custom data, gracefully close resources, and output final remarks about the simulation.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md41">
<title>ROCKY_PLUGIN_TEAR_DOWN_CUDA</title><para>In this hook the module must free the memory allocated for custom data in the GPU devices during the execution of <computeroutput>ROCKY_PLUGIN_INITIALIZE_CUDA</computeroutput>.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>int device_id</computeroutput></para>
<para>Identifier of an individual GPU.</para>
</listitem><listitem><para><computeroutput>void *device_data</computeroutput></para>
<para>Accepts a generic pointer associated with the GPU id that is returned back by other GPU-aware hooks. The module may use it as a mechanism to persist custom data between GPU devices during the simulation execution.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md42">
<title>General-purpose iteration hooks</title><para>These hooks are called on each iteration during the simulation loop in which the motion of the particles and all the enabled models are solved. As they are not related to a specific type of model, these hooks can be used for different purposes, such as collecting relevant simulation data, calculating useful complementary magnitudes related to the simulation, pre-processing data needed by some custom model, etc.</para>
<sect3 id="solver_hooks_1autotoc_md43">
<title>ROCKY_PLUGIN_BEGIN_ITERATION</title><para>The code attached to this hook is executed when a new cycle of calculations is initiated, corresponding to a new timestep, as depicted in Figure 3.1. At this point, a module may reset custom variables for a new iteration.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation. For a list of all the methods associated to <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref></computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md44">
<title>ROCKY_PLUGIN_BEGIN_ITERATION_CUDA</title><para>This hook is placed also at the beginning of a new cycle of calculations, but it is executed on each one of the active GPU devices, when a simulation runs in GPU.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *host_data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput>.</para>
</listitem><listitem><para><computeroutput>int device_id</computeroutput></para>
<para>Identifier of an individual GPU.</para>
</listitem><listitem><para><computeroutput>void *&amp;device_data</computeroutput></para>
<para>The generic pointer pointing to a copy of a local <computeroutput>struct</computeroutput> in a GPU device, provided in <computeroutput>ROCKY_PLUGIN_INITIALIZE_CUDA</computeroutput>.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md45">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_CONTACTS</title><para>The associated custom code will be executed before the calculation of contact forces, inside a loop over the active <ref refid="glossary_1frictional-contact" kindref="member">frictional contacts</ref>. A closing <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_CONTACTS_END()</computeroutput> statement must be inserted at the end of the custom code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>An active frictional contact object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md46">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_PARTICLES</title><para>The associated custom code will be executed before the calculation of contact forces, inside a loop over the active particles in the simulation. A closing <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_PARTICLES_END()</computeroutput> statement must be inserted at the end of the custom code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>An active particle object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md47">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_JOINTS</title><para>The associated custom code will be executed before the calculation of joint forces, inside a loop over the joints in all active multi-element particles in a simulation. A <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_JOINTS_END()</computeroutput> statement must be inserted at the end of the custom code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyJoint" kindref="compound">IRockyJoint</ref> &amp;joint</computeroutput></para>
<para>An active joint object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md48">
<title>ROCKY_PLUGIN_POST_FORCE_ON_CONTACTS</title><para>The associated custom code will be executed after the calculation of contact forces, inside a loop over the active frictional contacts. A closing <computeroutput>ROCKY_PLUGIN_POST_FORCE_ON_CONTACTS_END()</computeroutput> statement must be inserted at the end of the custom code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>An active frictional contact object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md49">
<title>ROCKY_PLUGIN_POST_FORCE_ON_PARTICLES</title><para>The associated custom code will be executed after the calculation of contact forces and the corresponding forces over particles, inside a loop over the active particles in the simulation. A closing <computeroutput>ROCKY_PLUGIN_POST_FORCE_ON_PARTICLES_END()</computeroutput> statement must be inserted at the end of the custom code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>An active particle object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md50">
<title>ROCKY_PLUGIN_POST_FORCE_ON_JOINTS</title><para>The associated custom code will be executed after the calculation of joint forces, inside a loop over the joints in all active multi-element particles in a simulation. A <computeroutput>ROCKY_PLUGIN_POST_FORCE_ON_JOINTS_END()</computeroutput> statement must be inserted at the end of the associated custom code.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyJoint" kindref="compound">IRockyJoint</ref> &amp;joint</computeroutput></para>
<para>An active joint object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md51">
<title>ROCKY_PLUGIN_PRE_MOVE_PARTICLES</title><para>The associated custom code is executed before Rocky updates the kinematic state of the particles. At the end of the custom code block, a closing <computeroutput>ROCKY_PLUGIN_PRE_MOVE_PARTICLES_END()</computeroutput> statement must be inserted.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>An active particle object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md52">
<title>ROCKY_PLUGIN_POST_MOVE_PARTICLES</title><para>The associated custom code is executed after Rocky has updated the kinematic state of the particles. At this point, updated positions and velocities for all active particles are available. At the end of the custom code block, a closing <computeroutput>ROCKY_PLUGIN_POST_MOVE_PARTICLES_END()</computeroutput> statement must be inserted.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>An active particle object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md53">
<title>ROCKY_PLUGIN_PRE_SEARCH_ON_PARTICLES</title><para>This hook is attached at a point before the first stage of contact detection, which is the search of neighbors for every active particle in the simulation (see the description of this operation on the <emphasis>DEM Technical Manual</emphasis>). This search operation is not executed at every time iteration. Its frequency depends on the dynamics of the particulate process being simulated, and it usually vary during a simulation. The code associated to this specific hook will be executed within a loop involving all the active particles. A closing <computeroutput>ROCKY_PLUGIN_PRE_SEARCH_ON_PARTICLES_END()</computeroutput> statement is required at the end of the code block.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>An active particle object. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md54">
<title>ROCKY_PLUGIN_COMPUTE_VICINITY_DISTANCE</title><para>This hook must be used as a part of modules implementing a model of long range interactions between particles and/or between particles and geometry triangles. In the case of long range interactions between particles, any pair of particles whose centroids are located at a distance smaller than a specified value is considered to have an active interaction, or in the nomenclature used in Rocky, they form a vicinity pair. In the case of interactions between a particle and a geometry triangle, a vicinity pair is formed in similar way, that is, when the distance between their centroids is lower than a specified value. The purpose of this hook is, as a matter of fact, to specify the value of that limiting distance, which in Rocky is called vicinity distance. It can be calculated based on other simulation parameters, and also can vary with time.</para>
<para>At each time iteration, Rocky will determine all vicinity pairs based on the simple criterion described above. Then, the hooks <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_PARTICLE_VICINITY_PAIR</computeroutput> and <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_TRIANGLE_VICINITY_PAIR</computeroutput> to calculate forces, heat transfer rates or any other interaction magnitudes for all particle-to-particle and particle-to-triangle vicinity pairs, respectively. If a project has several modules that specify different values of vicinity distance, Rocky will use the largest one.</para>
<para>The code block associated to this hook must end with a return statement, returning the value of the current vicinity distance, followed by a closing <computeroutput>ROCKY_PLUGIN_COMPUTE_VICINITY_DISTANCE_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Object that provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md55">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_PARTICLE_VICINITY_PAIR</title><para>This hook is intended for the calculation of long range particle-to-particle interaction magnitudes (forces, heat transfer rates, or other). A module implementing this kind of model must define previously the maximum distance at which the interaction is possible, by using the <computeroutput>ROCKY_PLUGIN_COMPUTE_VICINITY_DISTANCE</computeroutput> hook. Based on that distance, Rocky will determine all particle-to-particle vicinity pairs for which a long range interaction could be calculated within this hook. The code associated to this hook must end with a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_PARTICLE_VICINITY_PAIR_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyVicinityPair" kindref="compound">IRockyVicinityPair</ref> &amp;vicinity_pair</computeroutput></para>
<para>A particle-to-particle vicinity pair. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md56">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_TRIANGLE_VICINITY_PAIR</title><para>This hook is intended for the calculation of long range particle-to-triangle interaction magnitudes (forces, heat transfer rates, or other). A module implementing this kind of model must define previously the maximum distance at which the interaction is possible, by using the <computeroutput>ROCKY_PLUGIN_COMPUTE_VICINITY_DISTANCE</computeroutput> hook. Based on that distance, Rocky will determine all particle-to-triangle vicinity pairs for which a long range interaction could be calculated within this hook. The code associated to this hook must end with a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_TRIANGLE_VICINITY_PAIR_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyVicinityPair" kindref="compound">IRockyVicinityPair</ref> &amp;vicinity_pair</computeroutput></para>
<para>A particle-to-triangle vicinity pair. For a complete list of the associated methods, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md57">
<title>Hooks associated to specific models</title><para>The hooks described in this section must be used only by modules that add new models to Rocky.</para>
<sect3 id="solver_hooks_1autotoc_md58">
<title>ROCKY_PLUGIN_NORMAL_FORCE_ON_CONTACTS</title><para>When a module implements a custom contact model, the calculation of the normal component of the contact force must be made in the code attached to this hook. The custom calculation implemented here will override any built-in normal contact force model in Rocky. It is mandatory that the attached custom code block be closed with a <computeroutput>ROCKY_PLUGIN_NORMAL_FORCE_ON_CONTACTS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include the definition of the <computeroutput>normal_force_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom normal force model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The frictional contact for which the normal force is being calculated.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactIntermediateData" kindref="compound">IRockyContactIntermediateData</ref>&amp; intermediate_data</computeroutput></para>
<para>An object containing intermediate data useful for the calculation of contact forces. For a list of the available data in this object, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactOutputData" kindref="compound">IRockyContactOutputData</ref>&amp; output_data</computeroutput></para>
<para>The object that will receive the values calculated by a custom contact model and will deliver them to Rocky.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md59">
<title>ROCKY_PLUGIN_TANGENTIAL_FORCE_ON_CONTACTS</title><para>When a module implements a custom contact model, the calculation of the tangential component of the contact force must be made in the code attached to this hook. It is executed always after the calculation of the normal force component, either by a built-in model or by custom code in <computeroutput>ROCKY_PLUGIN_NORMAL_FORCE_ON_CONTACTS</computeroutput> (see Figure 3.2). Therefore, at this point, a value of the normal component of the contact force will be available for the calculation of the tangential component. If implemented in a module, the calculation in this hook will override any built-in tangential contact force model in Rocky. The custom code block must end with a closing <computeroutput>ROCKY_PLUGIN_TANGENTIAL_FORCE_ON_CONTACTS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include the definition of the tangential_force_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom tangential force model</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The frictional contact for which the tangential force is being calculated.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactIntermediateData" kindref="compound">IRockyContactIntermediateData</ref>&amp; intermediate_data</computeroutput></para>
<para>An object containing intermediate data useful for the calculation of contact forces. For a list of the available data in this object, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactOutputData" kindref="compound">IRockyContactOutputData</ref>&amp; output_data</computeroutput></para>
<para>An object that will receive the values calculated by a custom contact model and will deliver them to Rocky.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
<para><image type="html" name="hooks_contact.png" width="30%"></image>
 <image type="latex" name="hooks_contact.png"></image>
 <image type="rtf" name="hooks_contact.png"></image>
 <image type="docbook" name="hooks_contact.png"></image>
 <image type="xml" name="hooks_contact.png"></image>
</para>
<para><emphasis>Figure 3.2: Hooks used for the implementation of a contact model. The code associated to the hooks is executed in the order ndicated in this diagram</emphasis></para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md60">
<title>ROCKY_PLUGIN_IMPACT_ENERGY_ON_CONTACTS</title><para>Sometimes a custom contact model will require a special calculation of the impact energy, which is usually one of the main inputs for an <ref refid="glossary_1instantaneous-breakage" kindref="member">instantaneous breakage</ref> model. If such calculation is required, it must be implemented in this hook.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include the definition of the impact_energy_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom tangential force model</emphasis></para>
<para>As shown in Figure 3.2, it is always executed after the calculation of the normal and tangential components of the contact force, therefore, the availability of values of these forces for the impact energy calculation is guaranteed. The custom code block must end with a <computeroutput>ROCKY_PLUGIN_IMPACT_ENERGY_ON_CONTACTS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The frictional contact for which the impact energy is being calculated.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactIntermediateData" kindref="compound">IRockyContactIntermediateData</ref>&amp; intermediate_data</computeroutput></para>
<para>An object containing intermediate data useful for the calculation of contact forces. For a list of the available data in this object, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactOutputData" kindref="compound">IRockyContactOutputData</ref>&amp; output_data</computeroutput></para>
<para>An object that will receive the values calculated by a custom contact model and will deliver them to Rocky.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md61">
<title>ROCKY_PLUGIN_ROLLING_RESISTANCE_ON_CONTACTS</title><para>Besides implementing the calculation of the contact forces, a custom contact model may optionally calculate and set moments caused by rolling resistance. This hook, specifically designed for that purpose, is executed at the end of the contact model pipeline, as shown in Figure 3.2. The custom code block associated to this hook must end with a <computeroutput>ROCKY_PLUGIN_ROLLING_RESISTANCE_ON_CONTACTS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the implementation of the calculation of rolling resistance moments in this hook, the module must include within its specification file the definition of the <computeroutput>rolling_resistance_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom rolling resistance model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The frictional contact for which the rolling resistance moments must be calculated.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactIntermediateData" kindref="compound">IRockyContactIntermediateData</ref>&amp; intermediate_data</computeroutput></para>
<para>An object containing intermediate data useful for the calculation of contact forces. For a list of the available data in this object, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContactOutputData" kindref="compound">IRockyContactOutputData</ref>&amp; output_data</computeroutput></para>
<para>An object that will receive the values calculated by a custom contact model and will deliver them to Rocky.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md62">
<title>ROCKY_PLUGIN_COMPUTE_CONTACT_ADHESIVE_FORCES</title><para>When a module implements a custom adhesion model, the adhesive force acting in an <ref refid="glossary_1adhesive-contact" kindref="member">adhesive contact</ref> must be calculated in the associated block of code. That custom adhesion model will override any built-in adhesion model in Rocky. The block attached to this hook must end with a <computeroutput>ROCKY_PLUGIN_COMPUTE_CONTACT_ADHESIVE_FORCES_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the implementation of the calculation of rolling resistance moments in this hook, the module must include within its specification file the definition of the <computeroutput>adhesion_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom rolling resistance model.</emphasis></para>
<para>Normally, the adhesion force has only a component in the normal direction, but, for special cases, the custom code may calculate and deliver to Rocky a tangential component of the adhesion force as well. On the other hand, by convention in Rocky, adhesion forces are oriented in the same way that contact forces are oriented. Consequently, an attractive adhesion force must be prescribed with a negative sign.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The adhesive contact for which the adhesive force is being calculated.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyAdhesionOutputData" kindref="compound">IRockyAdhesionOutputData</ref> &amp;output_data</computeroutput></para>
<para>An object that will receive the values of the calculated components of the adhesion force and will deliver them to Rocky. It is mandatory to set the normal component of the adhesion force, but the tangential component is optional.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md63">
<title>ROCKY_PLUGIN_COMPUTE_JOINT_FORCES</title><para>A module implementing a custom joint model must include the calculation joint forces and moments in this block of code, based on the linear and angular joint deformations. Currently, the implementation of custom joint models is supported only for flexible fibers and shells.</para>
<para>The block of code implementing a custom joint model must end with a <computeroutput>ROCKY_PLUGIN_COMPUTE_JOINT_FORCES_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module’s specification file must include the definition of the joint_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom joint model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyJoint" kindref="compound">IRockyJoint</ref> &amp;joint</computeroutput></para>
<para>The joint for which the forces and moments are being calculated.</para>
</listitem><listitem><para><computeroutput>IRockyJointOutputData &amp;output_data</computeroutput></para>
<para>An object that will receive the values of the forces and moments and will deliver them to Rocky.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md64">
<title>ROCKY_PLUGIN_COMPUTE_JOINT_BREAKAGE</title><para>This hook must be used to implement a new criterion of <ref refid="glossary_1discrete-breakage" kindref="member">discrete breakage</ref> for multi-element flexible particles. If implemented, the associated code will be executed in a loop traversing the joints of all the multi-element particles enabled to break, after the calculation of joint forces and moments. When the custom criterion for breakage is satisfied, the boolean parameter that Rocky passes to the hook, <computeroutput>broken</computeroutput>, must be set to <computeroutput>true</computeroutput>. Only in this way Rocky will then disable the joint, effectively breaking up the link between the previously connected <ref refid="glossary_1element" kindref="member">elements</ref>.</para>
<para>Currently, custom criteria for joint breakage is supported only for flexible fibers and shells. In the specific case of shells, a custom breakage criterion will be evaluated only at the center point of a joint. Therefore, when that criterion is satisfied, the joint will break instantaneously and completely. This behavior is different from the built-in joint breakage models in Rocky, in which a period of partial breakage may exist before the joint fully breaks, as described on the DEM Technical Manual.</para>
<para>The associated code block that implements a joint breakage criterion must end with a <computeroutput>ROCKY_PLUGIN_COMPUTE_JOINT_BREAKAGE_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include the definition of the joint_breakage_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom discrete breakage criterion.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyJoint" kindref="compound">IRockyJoint</ref> &amp;joint</computeroutput></para>
<para>The joint that will be checked for breakage.</para>
</listitem><listitem><para><computeroutput>bool &amp;broken</computeroutput></para>
<para>Its value must be set to <computeroutput>true</computeroutput> if the joint is supposed to break.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md65">
<title>ROCKY_PLUGIN_INITIALIZE_INSTANTANEOUS_BREAKAGE</title><para>The code associated to this hook will be executed during the initialization of the simulation and after the generation of every new fragment at an instantaneous breakage event. It can be used for setting initial values for variables that a custom instantaneous breakage model may need.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyBreakableParticle" kindref="compound">IRockyBreakableParticle</ref> &amp;breakable_particle</computeroutput></para>
<para>An abstraction of a particle that is able to break by instantaneous breakage. For a list of the available methods, please see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md66">
<title>ROCKY_PLUGIN_COMPUTE_INSTANTANEOUS_BREAKAGE</title><para>This hook must be used to implement a new criterion for instantaneous breakage. If implemented, the associated code will be executed in a loop traversing all particles enabled to break, after the calculation of contact forces. At the moment the custom criterion for instantaneous breakage is satisfied, the boolean parameter passed by reference to the hook, <computeroutput>broken</computeroutput>, must be set to <computeroutput>true</computeroutput>. Later on in the same time iteration, Rocky will execute the fragmentation algorithm with the active fragment distribution model, for all particles that have satisfied that condition. The code block that implements a custom instantaneous breakage criterion must end with a closing <computeroutput>ROCKY_PLUGIN_COMPUTE_INSTANTANEOUS_BREAKAGE_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include the definition of the <computeroutput>instantaneous_breakage_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom instantaneous breakage criterion</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle that will be checked for breakage.</para>
</listitem><listitem><para><computeroutput>bool &amp;broken</computeroutput></para>
<para>Its value must be set to <computeroutput>true</computeroutput> if the calculations indicate that the particle is supposed to break.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md67">
<title>ROCKY_PLUGIN_INITIALIZE_FRAGMENTS_SIZE_DISTRIBUTION</title><para>The code associated to this hook will be executed during the initialization of the simulation and after the generation of every new fragment at an instantaneous breakage event. It can be used for setting initial values for variables that a custom fragment size distribution model may need.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyBreakableParticle" kindref="compound">IRockyBreakableParticle</ref> &amp;breakable_particle</computeroutput></para>
<para>An abstraction of a particle that is able to break by instantaneous breakage. For a list of the available methods, please see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md68">
<title>ROCKY_PLUGIN_COMPUTE_FRAGMENTS_SIZE_DISTRIBUTION</title><para>This hook can be used to implement a new model for the calculation of the size distribution of fragments in an instantaneous breakage event. It can be used either as a complement to a custom instantaneous breakage criterion or in a standalone module devised to work with built-in instantaneous breakage models in Rocky. In the latter case, the only constraint is that the calculation must be based on the value of the <formula id="4">t_{10}</formula> parameter, as in most of the built-in models in Rocky.</para>
<para><emphasis>Note:Besides the hook implementation, the module’s specification file must include the definition of the <computeroutput>fragments_size_distribution_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom fragments size distribution.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyBreakableParticle" kindref="compound">IRockyBreakableParticle</ref> &amp;breakable_particle</computeroutput></para>
<para>An abstraction of a particle that is able to break by instantaneous breakage. For a list of the available methods, please see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>std::vector&lt;double&gt;&amp; distribution</computeroutput></para>
<para>A vector containing the sizes of the fragments resulting in a breakage event, arranged in descending order.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md69">
<title>ROCKY_PLUGIN_COMPUTE_BOUNDARIES_WEAR</title><para>This hook can be used to implement a custom calculation of the surface wear caused by particle collisions on the boundaries (geometries) in a simulation. The associated code must calculate and deliver to Rocky the volume of <ref refid="glossary_1material" kindref="member">material</ref> worn from a boundary triangle during a simulation timestep in a single particle-geometry contact. Then, Rocky will collect the worn volumes from all triangles that make up the boundaries and will execute the algorithm of grid deformation on them. The associated custom code must be closed by a <computeroutput>ROCKY_PLUGIN_COMPUTE_BOUNDARIES_WEAR_END()</computeroutput> statement.</para>
<para>*Note: Besides the hook implementation, the module&apos;s specification file must include also the definition of the <computeroutput>geometries_wear_model</computeroutput> attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements<itemizedlist>
<listitem><para><bold>Parameters:</bold></para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;triangle_contact</computeroutput></para>
<para>A contact between a particle and a triangle from a wear-enabled geometry.</para>
</listitem><listitem><para><computeroutput>double&amp; wear_volume</computeroutput></para>
<para>The module must set in this variable the volume of material worn from the geometry as a result of the action of the contact forces on the <computeroutput>triangle_contact</computeroutput>, during a single timestep.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md70">
<title>ROCKY_PLUGIN_COMPUTE_CONTACT_HEAT_CONDUCTION</title><para>This hook can be used to implement a custom calculation of the heat transfer rate by conduction between two particles or between a particle and a <ref refid="glossary_1boundary" kindref="member">boundary</ref>. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_COMPUTE_CONTACT_HEAT_CONDUCTION_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include also the definition of the heat_conduction_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom contact heat conduction model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>The frictional contact at which the heat transfer rate is being calculated.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md71">
<title>ROCKY_PLUGIN_COMPUTE_THERMAL_INTEGRATION</title><para>This hook can be used to integrate the energy balance equation for a single particle, in order to update its temperature. This operation will require the use of the total heat transfer rate to the particle, calculated in previous steps (by conduction or any other mechanisms active in the simulation). The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_COMPUTE_THERMAL_INTEGRATION_END()</computeroutput> statement.</para>
<para><emphasis>Note: Besides the hook implementation, the module&apos;s specification file must include also the definition of the thermal_integration_model attribute, as explained in chapter Module specification, in order to inform Rocky that the module implements a custom thermal integration procedure</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle whose temperature must be updated by integrating the energy balance equation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
<sect3 id="solver_hooks_1autotoc_md72">
<title>ROCKY_PLUGIN_COMPUTE_GEOMETRIES_MOTION</title><para>This hook is intended for the implementation of a custom motion kernel. In Rocky, a motion kernel is responsible for moving geometries from one location in the domain to another during the simulation. The code associated to this hook will be executed at every Rocky timestep during the simulation. To work, the custom motion kernel must first know which geometries in the Rocky project are available for motion, which it gets from their Rocky IDs or names. Then at every timestep, it moves the proper geometries according to the custom motion kernel setup. No custom motion setup is done in Rocky; Rocky only provides in this hook the current position, orientation, translational and rotational velocities of the geometries and the forces and moments applied by the particles to the geometries, and then that information can be taken or not into account to calculate the next motion for the geometry.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref>&amp; model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyGeometriesMotionData" kindref="compound">IRockyGeometriesMotionData</ref>&amp; motion</computeroutput></para>
<para>A data structure that holds motion information for all geometries in the Rocky project.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md73">
<title>CFD coupling hooks</title><para>The Rocky Solver SDK includes a number a hooks intended for implementing new interaction models between particles and fluid flow. A custom model can implement one or several of those models, associating the corresponding code to appropriate hooks. It is worth noting, though, that the code related to all CFD coupling hooks used in a module must be grouped inside a block beginning with <computeroutput>ROCKY_PLUGIN_CFD_COUPLING()</computeroutput> and ending with <computeroutput>ROCKY_PLUGIN_CFD_COUPLING_END()</computeroutput>.</para>
<para>The code associated to CFD coupling hooks will have effect only on both constant and Fluent 1-way coupling modes, as well as on the Fluent 2-way coupling mode. For details about how the CFD coupling models are defined in Rocky, please refer to the DEM-CFD Coupling Technical Manual.</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md74">
<title>ROCKY_PLUGIN_CFD_COUPLING_DRAG_COEFFICIENT</title><para>This hook is intended for the calculation of a custom drag coefficient, which, in turn, Rocky will use to calculate the drag force acting over a particle. This force will be calculated by means of equation 3.5 of the DEM-CFD Coupling Technical Manual. The associated code block must end with a <computeroutput>return</computeroutput> statement, returning the calculated coefficient value, followed by a closing <computeroutput>ROCKY_PLUGIN_CFD_COUPLING_DRAG_COEFFICIENT_END()</computeroutput> statement.</para>
<para><emphasis>Note: In order to inform Rocky that a module implements a custom drag coefficient calculation, the module’s specification file must include the definition of the <computeroutput>cfd_drag_law_model</computeroutput> attribute, as explained in chapter Module specification.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle on which the calculated drag force will be applied.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the particle-fluid interactions. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md75">
<title>ROCKY_PLUGIN_CFD_COUPLING_LIFT_COEFFICIENT</title><para>This hook is intended for the calculation of a custom lift coefficient, which, in turn, Rocky will use to calculate the lift force acting over a particle. This force will be calculated by means of equation 3.69 of the DEM-CFD Coupling Technical Manual. The associated code block must end with a <computeroutput>return</computeroutput> statement, returning the calculated coefficient value, followed by a closing <computeroutput>ROCKY_PLUGIN_CFD_COUPLING_LIFT_COEFFICIENT_END()</computeroutput> statement.</para>
<para><emphasis>Note: In order to inform Rocky that a module implements a custom lift coefficient calculation, the module’s specification file must include the definition of the <computeroutput>cfd_lift_law_model</computeroutput> attribute, as explained in chapter Module specification.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle on which the calculated lift force will be applied.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md76">
<title>ROCKY_PLUGIN_CFD_COUPLING_VIRTUAL_MASS_COEFFICIENT</title><para>This hook is intended for the calculation of a custom virtual mass coefficient, which, in turn, Rocky will use to calculate the virtual mass and the a ssociated force acting over a particle. This force will be calculated by means of equation 3.65 of the DEM-CFD Coupling Technical Manual. The associated code block must end with a <computeroutput>return</computeroutput> statement, returning the calculated coefficient value, followed by a closing <computeroutput>ROCKY_PLUGIN_CFD_COUPLING_VIRTUAL_MASS_COEFFICIENT_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle on which the calculated virtual mass force will be applied.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
<para><emphasis>Note: In order to inform Rocky that a module implements a custom virtual mass calculation, the module’s specification file must include the definition of the <computeroutput>cfd_virtual_mass_law_model</computeroutput> attribute, as explained in chapter Module specification</emphasis></para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md77">
<title>ROCKY_PLUGIN_CFD_COUPLING_TORQUE_COEFFICIENT</title><para>This hook is intended for the calculation of a custom torque coefficient, which, in turn, Rocky will use to calculate the flow-generated torque acting over a particle. This force will be calculated by means of equation 3.78 of the DEM-CFD Coupling Technical Manual. The associated code block must end with a <computeroutput>return</computeroutput> statement, returning the calculated coefficient value, followed by a closing ROCKY_PLUGIN_CFD_COUPLING_TORQUE_COEFFICIENT_END()` statement.</para>
<para><emphasis>Note: In order to inform Rocky that a module implements a custom torque coefficient calculation, the module’s specification file must include the definition of the <computeroutput>cfd_torque_law_model</computeroutput> attribute, as explained in chapter Module specification.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle on which the calculated torque will be applied.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="solver_hooks_1autotoc_md78">
<title>ROCKY_PLUGIN_CFD_COUPLING_NUSSELT_NUMBER</title><para>This hook is intended for the calculation of a custom Nusselt number, which, in turn, Rocky will use to calculate the heat transfer rate between a particle and the surrounding fluid. The heat transfer coefficient based on the calculated Nusselt number will be obtained by means of equation 4.3 of the DEM-CFD Coupling Technical Manual. Afterwards, the convective heat transfer rate will be calculated with equation 4.2 of the referred manual. The code block associated to this hook must end with a <computeroutput>return</computeroutput> statement, returning the calculated coefficient value, followed by a closing <computeroutput>ROCKY_PLUGIN_CFD_COUPLING_LIFT_COEFFICIENT_END()</computeroutput> statement.</para>
<para><emphasis>Note: In order to inform Rocky that a module implements a custom Nusselt number calculation, the module&apos;s specification file must include the definition of the <computeroutput>cfd_convection_law_model</computeroutput> attribute, as explained in chapter Module specification.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle to which the calculated the convective heat transfer rate is referred.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
<sect3 id="solver_hooks_1autotoc_md79">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_FLUID</title><para>The code associated to this hook will be executed before the calculation of the CFD coupling coefficients and the corresponding forces and heat transfer rates. It can be used for performing some pre-calculation needed in later hooks. The associated code block must be closed with a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_FLUID_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle to which the CFD coupling interaction properties are referred.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md80">
<title>ROCKY_PLUGIN_POST_FORCE_ON_FLUID</title><para>The code associated to this hook will be executed after the calculation of the CFD coupling coefficients and the corresponding forces and heat transfer rates. The associated code block must be closed with a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_FLUID_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle to which the CFD coupling interaction properties are referred.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md81">
<title>ROCKY_PLUGIN_PRE_MOVE_ON_FLUID</title><para>The code associated to this hook will be executed after the calculation of the CFD coupling forces and heat transfer rates, but before solving the motion equations for the particles. The associated code block must be closed with a <computeroutput>ROCKY_PLUGIN_PRE_MOVE_ON_FLUID_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle to which the CFD coupling interaction properties are referred.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md82">
<title>ROCKY_PLUGIN_POST_MOVE_ON_FLUID</title><para>The code associated to this hook will be executed after the calculation of the CFD coupling forces and heat transfer rates, and after solving the motion equations for the particles. The associated code block must be closed with a <computeroutput>ROCKY_PLUGIN_POST_MOVE_ON_FLUID_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>General information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticle" kindref="compound">IRockyParticle</ref> &amp;particle</computeroutput></para>
<para>The particle to which the CFD coupling interaction properties are referred.</para>
</listitem><listitem><para><computeroutput>RockyCFDProperties &amp;cfd</computeroutput></para>
<para>A data structure containing data related to the fluid flow and the interaction particle-fluid. For list of the available data, please refer to chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md83">
<title>SPH hooks</title><para>Latest versions of Rocky include a feature that implements the Smoothed Particle Hydrodynamics (SPH) method as a new option for adding fluid flow interacting with the particles in a simulation. Currently the Rocky Solver SDK includes some hooks, classes and methods specifically designed for the implementation of custom models that may override or complement the SPH model implemented within Rocky. This section describes the hooks that the current version includes for that effect.</para>
<para>Figure 3.3 shows schematically the points where the SPH hooks are located in relation to the regular hooks provided by the Rocky Solver SDK.</para>
<para><image type="html" name="hooks_sph_flowchart.png" width="30%"></image>
 <image type="latex" name="hooks_sph_flowchart.png"></image>
 <image type="rtf" name="hooks_sph_flowchart.png"></image>
 <image type="docbook" name="hooks_sph_flowchart.png"></image>
 <image type="xml" name="hooks_sph_flowchart.png"></image>
</para>
<para><emphasis>Figure 3.3: Position of the SPH hooks (in black) relative to the regular hooks (in green) and the main operations made during a simulation.</emphasis></para>
<para>As shown in Figure 3.3, the calculation of SPH forces and the hooks related to that operation are executed after the calculation of the DEM forces. Moreover, the solution of the SPH motion equation is made also after the solution of the corresponding DEM motion equations. However, the SPH <computeroutput>PRE_MOVE</computeroutput> hooks are executed before the solution of the DEM motion equations.</para>
<para>It is important to note that in the implementation of a custom SPH module, all hooks related to SPH must be included in a block beginning with a <computeroutput>ROCKY_PLUGIN_SPH</computeroutput> instruction. Moreover, that block must be closed with a <computeroutput>ROCKY_PLUGIN_SPH_END</computeroutput> statement.</para>
<para>A feature only present on SPH hooks is the possibility of replicating a hook multiple times in order to implement short iterative subroutines. Unlike other calculations in Rocky, this iterative subroutines can be executed in the same time level in order to solve coupling between flow variables. As shown schematically in Figure 3.4, each new iteration must be attached to a new hook, which has the same name as the base-hook, but suffixed with an index.</para>
<para><emphasis>Note: Currently, those indexes can go up to 4; therefore, these iterative subroutines may have up to 5 iterations altogether.</emphasis></para>
<para>If defined in the code associated to a module, these indexed hooks will be executed in sequence before proceeding to the next step in the implemented algorithm. All the SPH hooks included in Figure 3.3 for <computeroutput>ROCKY_PLUGIN_INITIALIZE_SPH_ELEMENT</computeroutput>, <computeroutput>ROCKY_PLUGIN_FORCE_ON_SPH_ELEMENT_INTERACTIONS</computeroutput> and <computeroutput>ROCKY_PLUGIN_FORCE_ON_SPH_TRIANGLE_INTERACTIONS</computeroutput> can be indexed in the way indicated in Figure 3.4 for implementing short iterative subroutines. Currently, those indexes can go up to 4; therefore, these iterative subroutines may have up to 5 iterations altogether.</para>
<para><image type="html" name="hooks_sph_detail.png" width="30%"></image>
 <image type="latex" name="hooks_sph_detail.png"></image>
 <image type="rtf" name="hooks_sph_detail.png"></image>
 <image type="docbook" name="hooks_sph_detail.png"></image>
 <image type="xml" name="hooks_sph_detail.png"></image>
</para>
<para><emphasis>Figure 3.4: Replication of SPH hooks for the implementation of short iterative subroutines.</emphasis></para>
<sect3 id="solver_hooks_1autotoc_md84">
<title>ROCKY_PLUGIN_INITIALIZE_SPH_ELEMENT</title><para>This hook is designed for initializing SPH element scalars with values different from zero, which is the default value when they are created. Like all initialization hooks, this hook is executed always in CPU, within a loop over all SPH elements.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref>&amp; model</computeroutput></para>
<para>An object that provides data about the general configuration of the Rocky simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHModel" kindref="compound">IRockySPHModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about the general configuration of the flow model discretized with the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementHost" kindref="compound">IRockySPHElementHost</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element contained in the simulation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md85">
<title>ROCKY_PLUGIN_FORCE_ON_SPH_ELEMENT_INTERACTIONS</title><para>The purpose of this hook is to calculate forces that SPH elements exert on each other using custom models. If a custom module implements code associated to this hook, it will override the calculation of all forces between SPH elements made within Rocky&apos;s built-in SPH. This means that such custom module will take the responsibility of calculating pressure forces, viscous forces, and any other interaction forces that SPH elements could exert on each other. The resultant of those forces must be passed to Rocky by using the <computeroutput><ref refid="structIRockySPHElementInteraction_1a1ee1b8234e2660a09b7b1a7fe3ba0e07" kindref="member">IRockySPHElementInteraction::add_force</ref></computeroutput> method in order to be applied to the interacting SPH elements. Alternatively, the module can pass custom calculated resultant accelerations to Rocky by using the <computeroutput><ref refid="structIRockySPHElementInteraction_1a713381036ee74bb8476435037c14124b" kindref="member">IRockySPHElementInteraction::add_acceleration</ref></computeroutput> method. Additionally, the code block associated to this hook must be closed by a <computeroutput>ROCKY_PLUGIN_FORCE_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md86">
<title>ROCKY_PLUGIN_FORCE_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This hook is intended for calculating the interaction forces between SPH elements and geometry triangles. If a custom module implements code associated to this hook, it will override the calculation of those forces made within Rocky&apos;s built-in SPH. The resultant of the interaction forces calculated within the code associated to this hook must be passed to Rocky by using the <computeroutput><ref refid="structIRockySPHTriangleInteraction_1a749ae0224b1bd279d33404b3d0b84010" kindref="member">IRockySPHTriangleInteraction::add_force</ref></computeroutput> method in order to be applied to the respective SPH element and the geometry triangle. Alternatively, for the SPH element exclusively, the module can pass the calculated resultant acceleration to Rocky by using the <computeroutput><ref refid="structIRockySPHElementInteraction_1a713381036ee74bb8476435037c14124b" kindref="member">IRockySPHElementInteraction::add_acceleration</ref></computeroutput> method. Additionally, the code block associated to this hook must end with a <computeroutput>ROCKY_PLUGIN_FORCE_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md87">
<title>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENTS</title><para>This hook is intended for calculating forces due to surface tension within a loop over SPH elements. There is an alternative hook (<computeroutput>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENT_INTERACTIONS</computeroutput>) if the calculation of those forces needs to be done within a loop over SPH element interactions. As the surface tension force acts on the normal direction to a free surface, whenever a custom surface tension model is active in a simulation, a normal vector is calculated internally for all SPH elements according to the continuum approximation of interfaces. The calculated surface tension force must be passed to Rocky by using the <computeroutput><ref refid="structIRockySPHElement_1a0d51cf017a85bd175db6d18538c9d2e0" kindref="member">IRockySPHElement::add_force()</ref></computeroutput> method. Alternatively, the module can pass the acceleration caused by that force, by using the <computeroutput><ref refid="structIRockySPHElement_1a2f90b3a2980c2fa73cd53e72ea277f76" kindref="member">IRockySPHElement::add_acceleration()</ref></computeroutput> method. The code block associated to this hook must be closed by a <computeroutput>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Rocky must be informed that the module implements a surface tension model, by including the <computeroutput>sph_surface_tension_model</computeroutput> attribute in the module’s specification file. Please also note that a module implementing a custom surface tension model must include only code associated to the hook over SPH elements or to the hook over SPH element interactions, but not both.</emphasis></para>
<para><emphasis>Note: For additional details on the normal vector of the free surface calculation, please refer to the documentation of the <ref refid="structIRockySPHElement_1af2f5b34f666646f5d1f19207bac5cb2d" kindref="member">IRockySPHElement::get_normal()</ref> method.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput> containing custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md88">
<title>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENT_INTERACTIONS</title><para>This hook is intended for calculating forces due to surface tension within a loop over SPH element interactions. There is an alternative hook (<computeroutput>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENTS</computeroutput>) if the calculation of those forces needs to be done within a loop over SPH elements. As the surface tension force acts on the normal direction to a free surface, whenever a custom surface tension model is active in a simulation, a normal vector is calculated internally for all SPH elements according to the continuum approximation of interfaces. The calculated surface tension force must be passed to Rocky by using the <computeroutput><ref refid="structIRockySPHElementInteraction_1a1ee1b8234e2660a09b7b1a7fe3ba0e07" kindref="member">IRockySPHElementInteraction::add_force()</ref></computeroutput> method in order to be applied to the interacting SPH elements. Alternatively, the module can pass the acceleration caused by that force, by using the <computeroutput><ref refid="structIRockySPHElementInteraction_1a713381036ee74bb8476435037c14124b" kindref="member">IRockySPHElementInteraction::add_acceleration()</ref></computeroutput> method. The code block associated to this hook must be closed by a <computeroutput>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Rocky must be informed that the module implements a surface tension model, by including the <computeroutput>sph_surface_tension_model</computeroutput> attribute in the module&apos;s specification file. Please also note that a module implementing a custom surface tension model must include only code associated to the hook over SPH elements or to the hook over SPH element interactions, but not both.</emphasis></para>
<para><emphasis>Note: For additional details on the normal vector of the free surface calculation, please refer to the documentation of the <ref refid="structIRockySPHElement_1af2f5b34f666646f5d1f19207bac5cb2d" kindref="member">IRockySPHElement::get_normal()</ref> method.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput> containing custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md89">
<title>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_TRIANGLE_INTERACTIONS</title><para>Some surface tension models may need to apply forces associated to interactions between SPH elements and geometry triangles. This hook may be used for that purpose. If calculated, the force value must be passed to Rocky by using the <ref refid="structIRockySPHTriangleInteraction_1a749ae0224b1bd279d33404b3d0b84010" kindref="member">IRockySPHTriangleInteraction::add_force()</ref><computeroutput>method in order to be applied to the respective SPH element and the geometry triangle. Alternatively, the module can pass the acceleration value caused by that force with the</computeroutput><ref refid="structIRockySPHTriangleInteraction_1a1578dfd6da083096eb169fe24913dd5b" kindref="member">IRockySPHTriangleInteraction::add_acceleration()</ref><computeroutput>method. The code block associated to this hook must be closed with a</computeroutput>ROCKY_PLUGIN_SURFACE_TENSION_ON_SPH_TRIANGLE_INTERACTIONS_END()` statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput> containing custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md90">
<title>ROCKY_PLUGIN_VISCOUS_ACCELERATIONS_ON_SPH_ELEMENT_INTERACTIONS</title><para>This hook is intended for overriding the built-in calculations of the accelerations caused by viscous forces in element-to-element interactions. When a custom module including code associated to this hook is active on a simulation, the internal calculation of the viscous forces is skipped and the value returned by the implemented code is used instead. Such code may be used for implementing a SPH discretization of the Newtonian viscous term different from the built-in alternatives in Rocky, or, otherwise, for introducing a specific non-Newtonian viscosity law. The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated viscous acceleration, followed by a closing <computeroutput>ROCKY_PLUGIN_VISCOUS_ACCELERATIONS_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput> containing custom data.</para>
</listitem></itemizedlist>
</para>
<para><emphasis>Note: Rocky must be informed also that the module implements viscous accelerations, by including the <computeroutput>sph_viscous_force_model</computeroutput> attribute in the module’s specification file, as explained in chapter Module specification.</emphasis></para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md91">
<title>ROCKY_PLUGIN_VISCOUS_ACCELERATIONS_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This hook is intended for overriding the built-in calculations of the accelerations caused by viscous forces in element-to-geometry-triangle interactions. When a custom module including code associated to this hook is active on a simulation, the internal calculation of the viscous forces is skipped and the value returned by the implemented code is used instead. Such code may be used for implementing a SPH discretization of the Newtonian viscous term different from the built-in alternatives in Rocky, or, otherwise, for introducing a specific non-Newtonian viscosity law. The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated viscous acceleration, followed by a closing <computeroutput>ROCKY_PLUGIN_VISCOUS_ACCELERATIONS_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><emphasis>Note: Rocky must be informed also that the module implements viscous accelerations, by including the <computeroutput>sph_viscous_force_model</computeroutput> attribute in the module’s specification file, as explained in chapter Module specification</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput> An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput> containing custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md92">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_ELEMENTS</title><para>This is a general-purpose hook executed before the calculation of the SPH forces, inside a loop over all active SPH elements in a simulation. It can be used, for instance, for the calculation of element-related physical magnitudes needed in the subsequent calculation of the interaction SPH forces. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md93">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_ELEMENT_INTERACTIONS</title><para>This is a general-purpose hook executed before the calculation of the SPH forces, inside a loop over all active SPH element pairs with force interactions. It can be used, for instance, for the calculation of physical magnitudes associated to SPH element pairs, needed in the subsequent calculation of the interaction SPH forces. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md94">
<title>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This is a general-purpose hook executed before the calculation of the SPH forces, inside a loop over all active interactions between SPH elements and geometry triangles. It can be used, for instance, for the calculation of physical magnitudes associated to those interactions, needed in the subsequent calculation of the interaction SPH forces. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md95">
<title>ROCKY_PLUGIN_POST_FORCE_ON_SPH_ELEMENTS</title><para>This is a general-purpose hook executed after the calculation of the SPH forces, inside a loop over all active SPH elements in a simulation. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_POST_FORCE_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md96">
<title>ROCKY_PLUGIN_POST_FORCE_ON_SPH_ELEMENT_INTERACTIONS</title><para>This is a general-purpose hook executed after the calculation of the SPH forces, inside a loop over all active SPH element pairs with force interactions. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_POST_FORCE_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md97">
<title>ROCKY_PLUGIN_POST_FORCE_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This is a general-purpose hook executed after the calculation of the SPH forces, inside a loop over all active interactions between SPH elements and geometry triangles. The associated code must be closed by a <computeroutput>ROCKY_PLUGIN_PRE_FORCE_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md98">
<title>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_ELEMENTS</title><para>This is a general-purpose hook executed before the solution of the motion equations for the SPH elements, inside a loop over all active SPH elements in a simulation. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md99">
<title>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_ELEMENT_INTERACTIONS</title><para>This is a general-purpose hook executed before the solution of the motion equations for the SPH elements, inside a loop over all active SPH element pairs with force interactions. The associated code must end with a <computeroutput>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md100">
<title>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This is a general-purpose hook executed before the solution of the motion equations for the SPH elements, inside a loop over all active interactions between SPH elements and geometry triangles. The code must end with a <computeroutput>ROCKY_PLUGIN_PRE_MOVE_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md101">
<title>ROCKY_PLUGIN_POST_MOVE_ON_SPH_ELEMENTS</title><para>This is a general-purpose hook executed after the solution of the motion equations for the SPH elements, inside a loop over all active SPH elements in a simulation. The associated code block must be closed by a <computeroutput>ROCKY_PLUGIN_POST_MOVE_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing a SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md102">
<title>ROCKY_PLUGIN_POST_MOVE_ON_SPH_ELEMENT_INTERACTIONS</title><para>This is a general-purpose hook executed after the solution of the motion equations for the SPH elements, inside a loop over all active SPH element pairs with force interactions. The associated code must end with a <computeroutput>ROCKY_PLUGIN_POST_MOVE_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md103">
<title>ROCKY_PLUGIN_POST_MOVE_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This is a general-purpose hook executed after the solution of the motion equations for the SPH elements, inside a loop over all active interactions between SPH elements and geometry triangles. The code must end with a <computeroutput>ROCKY_PLUGIN_POST_MOVE_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md104">
<title>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_ELEMENT_INTERACTIONS</title><para>This is the hook that a custom module must use for overriding the built-in SPH element-to-element thermal calculations implemented within the Rocky solver.</para>
<para>The code associated to this hook will be executed before solving the motion equations of DEM particles and SPH elements, as shown in Figure 3.3. The custom code must calculate the heat transfer rate going from free SPH elements to other free SPH elements and also from free SPH elements to SPH elements linked to DEM particles. On the other hand, the thermal interaction between two linked SPH elements can be ignored, since the heat exchanged between DEM particles is handled by the code related to DEM. To work properly, a custom SPH thermal module must also implement the calculation of the SPH element-to-geometry-triangle heat transfer rate within the <computeroutput>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_TRIANGLE_INTERACTIONS</computeroutput> hook. The update of the temperature of all SPH particles will be made internally by the Rocky solver based on the balance of thermal energy.</para>
<para>The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated heat transfer rate value, followed by a closing <computeroutput>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_ELEMENT_INTERACTIONS_END()</computeroutput> statement.</para>
<para><emphasis>Note: The specification&apos;s file of such a module must include the definition of the <computeroutput>sph_heat_transfer_model</computeroutput> attribute, in order to be recognized as a module implementing a custom SPH thermal model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElementInteraction" kindref="compound">IRockySPHElementInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing a pair of SPH elements located within the support region of each other.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md105">
<title>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_TRIANGLE_INTERACTIONS</title><para>This is the hook that a custom module must use for overriding the built-in SPH element-to-geometry triangle thermal calculations implemented within the Rocky solver.</para>
<para>The code associated to this hook will be executed immediately after the <computeroutput>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_ELEMENT_INTERACTIONS</computeroutput> hook and before solving the motion equations of DEM particles and SPH elements, as shown in Figure 3.3. The custom code must calculate only the heat transfer rate exchanged between free SPH elements and geometry triangles. The thermal interaction between linked SPH elements and geometry triangles can be ignored, because it is handled by the DEM-related code.</para>
<para>The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated heat transfer rate value, followed by a closing <computeroutput>ROCKY_PLUGIN_HEAT_TRANSFER_ON_SPH_TRIANGLE_INTERACTIONS_END()</computeroutput> statement.</para>
<para><emphasis>Note: The specification&apos;s file of such a module must include the definition of the <computeroutput>sph_heat_transfer_model</computeroutput> attribute, in order to be recognized as a module implementing a custom SPH thermal model</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHTriangleInteraction" kindref="compound">IRockySPHTriangleInteraction</ref>&amp; sph_interaction</computeroutput></para>
<para>An object representing an interacting pair SPH element-geometry triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md106">
<title>ROCKY_PLUGIN_MOLECULAR_VISCOSITY_ON_SPH_ELEMENTS</title><para>This hook allows SDK users to override the viscosity value set in the UI. The code associated to this hook will be executed during initialization and on every iteration before the SPH viscous force calculations.</para>
<para>The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated viscosity value, followed by a closing <computeroutput>ROCKY_PLUGIN_MOLECULAR_VISCOSITY_ON_SPH_ELEMENTS_END()</computeroutput> statement.</para>
<para><emphasis>Note: The specification file of such a module must include the definition of the <computeroutput>sph_variable_molecular_viscosity</computeroutput> attribute, in order to be recognized as a module implementing a variable molecular viscosity model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHElement" kindref="compound">IRockySPHElement</ref>&amp; sph_element</computeroutput></para>
<para>An object representing an SPH element.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md107">
<title>ROCKY_PLUGIN_HEAT_TRANSFER_COEFFICIENT_CORRELATION_ON_TRIANGLES</title><para>This hook allows SDK users to calculate the Heat Transfer Coefficient (HTC) on the triangles. The usage of this hook does not require thermal model to be enabled, since its main usage is to calculate HTC on a triangle through correlations, with average velocity and average fluid properties on the neighborhood of that triangle as inputs.</para>
<para>The code associated to this hook will be executed immediately before the output step, where the data will be saved in disk.</para>
<para>The associated code must end with a <computeroutput>return</computeroutput> statement that returns the calculated heat transfer coefficient value, followed by a closing <computeroutput>ROCKY_PLUGIN_HEAT_TRANSFER_COEFFICIENT_CORRELATION_ON_TRIANGLES_END()</computeroutput> statement.</para>
<para><emphasis>Note: The specification file of such a module must include the definition of the <computeroutput>sph_heat_transfer_coefficient</computeroutput> attribute, in order to be recognized as a module implementing a variable molecular viscosity model.</emphasis></para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref>&amp; model</computeroutput></para>
<para>An object that provides general information about the current state of the simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockySPHDeviceModel" kindref="compound">IRockySPHDeviceModel</ref>&amp; sph_model</computeroutput></para>
<para>An object that provides data about current state of the flow model discretized using the SPH method.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyGeometryTriangle" kindref="compound">IRockyGeometryTriangle</ref>&amp; triangle</computeroutput></para>
<para>An object representing a geometry triangle.</para>
</listitem><listitem><para><computeroutput>const float3&amp; average_velocity</computeroutput></para>
<para>The average velocity of SPH on the neighborhood of the triangle.</para>
</listitem><listitem><para><computeroutput>const float&amp; average_viscosity</computeroutput></para>
<para>The average viscosity on the neighborhood of the triangle.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
<sect2 id="solver_hooks_1autotoc_md108">
<title>Output hooks</title><para>The current version of the Rocky Solver SDK includes some hooks intended for enabling modules to deliver custom data to Rocky in order to be saved, visualized and post-processed. The output of custom data can be made only at output times, when Rocky&apos;s own data is stored in disk as well.</para>
<sect3 id="solver_hooks_1autotoc_md109">
<title>ROCKY_PLUGIN_PRE_OUTPUT_CUDA_SYNC_DATA</title><para>When running a simulation in GPU, all custom data is copied to the GPU devices during the initialization stage and then processed entirely there. Therefore, when it is required to deliver portions of this data to Rocky for visualization and post-processing purposes, it has to be copied back to the CPU.</para>
<para><emphasis>Note: The exception are the scalar variaables added by the module, which are synchronized and made available for visualization automatically by Rocky.However, any other custom data that will need to be outputted must be copied to the CPU within this hook.</emphasis></para>
<para>This hook is intended primarily for performing that operation with custom data. The associated code will be executed at output times, before Rocky performs the output of its own data, as shown in Figure 3.1.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *host_data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem><listitem><para><computeroutput>int device_id</computeroutput></para>
<para>Identifier of an individual GPU.</para>
</listitem><listitem><para><computeroutput>void *device_data</computeroutput></para>
<para>The generic pointer pointing to a copy of a local <computeroutput>struct</computeroutput> in a GPU device, provided in <computeroutput>ROCKY_PLUGIN_INITIALIZE_CUDA</computeroutput>.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md110">
<title>ROCKY_PLUGIN_PRE_OUTPUT</title><para>This hook must be used for performing operations on custom data that need to be done before Rocky begins the writing of output data on disk. An operation that may be done within this hook is the update of the datasets that are used to store data that Rocky will display as time curves and cross-plot curves.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md111">
<title>ROCKY_PLUGIN_PRE_OUTPUT_ON_CONTACTS</title><para>The code associated to this hook will be executed within a loop including all active frictional contacts, at a point before the writing of output data on disk. This hook can be employed for transferring data stored in contact scalars to other data structures, as it is done, for instance, on collision statistics modules.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyDeviceModel" kindref="compound">IRockyDeviceModel</ref> &amp;device_model</computeroutput></para>
<para>An object that provides data about the current state of the simulation, stored within a device.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyContact" kindref="compound">IRockyContact</ref> &amp;contact</computeroutput></para>
<para>An active frictional contact object.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md112">
<title>ROCKY_PLUGIN_OUTPUT_PARTICLE_PROPERTY</title><para>The purpose of this hook is to populate particle properties with values calculated by a custom module. Rocky will display these values per particle according to a color scale, in the same way as any built-in particle property.</para>
<para><emphasis>Note: This operation is not needed for particle scalars, which are automatically displayed by Rocky as particle properties, if the parameter output is specified as true when creating the scalars with the method <computeroutput>add</computeroutput>.</emphasis></para>
<para>The code associated to this hook will be executed within a nested loop involving all active particles and all custom particle properties defined previously within the <computeroutput>ROCKY_PLUGIN_SETUP_OUTPUT_PROPERTIES</computeroutput> hook.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticleHost" kindref="compound">IRockyParticleHost</ref>&amp; particle</computeroutput></para>
<para>An active particle.</para>
</listitem><listitem><para><computeroutput>int property_id</computeroutput></para>
<para>The index associated to the custom particle property for which values must be specified within the hook. The value of this index is assigned according to the order in which the particle properties were specified within the <computeroutput>ROCKY_PLUGIN_SETUP_OUTPUT_PROPERTIES</computeroutput> hook, starting at zero.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md113">
<title>ROCKY_PLUGIN_OUTPUT_TRIANGLE_PROPERTY</title><para>The purpose of this hook is to populate geometry triangle properties with values calculated by a custom module. Rocky will display these values per geometry triangle according to a color scale, in the same way as any built-in geometry property.</para>
<para><emphasis>Note: This operation is not needed for triangle scalars, which are automatically displayed by Rocky as geometry triangle properties, if the parameter output is specified as <computeroutput>true</computeroutput> when creating the scalars with the method <computeroutput>add</computeroutput>.</emphasis></para>
<para>The code associated to this hook will be executed within a nested loop involving all active particles and all custom triangle properties defined previously within the <computeroutput>ROCKY_PLUGIN_SETUP_OUTPUT_PROPERTIES</computeroutput> hook.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput><ref refid="structIRockyParticleHost" kindref="compound">IRockyParticleHost</ref>&amp; particle</computeroutput></para>
<para>An active particle.</para>
</listitem><listitem><para><computeroutput>int property_id</computeroutput></para>
<para>The index associated to the custom triangle property for which values must be specified within the hook. The value of this index is assigned according to the order in which the triangle properties were specified within the <computeroutput>ROCKY_PLUGIN_SETUP_OUTPUT_PROPERTIES</computeroutput> hook, starting at zero.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md114">
<title>ROCKY_PLUGIN_POST_OUTPUT</title><para>This hook must be used for performing simple operations on custom data after an output has been made, such as resetting counters or accumulators.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md115">
<title>ROCKY_PLUGIN_END_ITERATION</title><para>The code attached to this hook is executed when the cycle of calculations for a time step ends, right before starting a new time step, in Figure 3.1.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation. For a list of all the methods associated to <computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref></computeroutput>, see chapter <ulink url="annotated.xhtml">Reference</ulink>.</para>
</listitem><listitem><para><computeroutput>void *data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput>, pointing to the user&apos;s custom data.</para>
</listitem></itemizedlist>
</para>
</sect3>
<sect3 id="solver_hooks_1autotoc_md116">
<title>ROCKY_PLUGIN_END_ITERATION_CUDA</title><para>This hook is placed also at the end of a cycle of calculations, but it is executed on each one of the active GPU devices, when a simulation runs in GPU.</para>
<para><bold>Parameters:</bold></para>
<para><itemizedlist>
<listitem><para><computeroutput><ref refid="structIRockyModel" kindref="compound">IRockyModel</ref> &amp;model</computeroutput></para>
<para>Provides data about the general configuration of a simulation.</para>
</listitem><listitem><para><computeroutput>void *host_data</computeroutput></para>
<para>The generic pointer provided in <computeroutput>ROCKY_PLUGIN_CONFIGURE</computeroutput> for pointing to a local <computeroutput>struct</computeroutput>.</para>
</listitem><listitem><para><computeroutput>int device_id</computeroutput></para>
<para>Identifier of an individual GPU.</para>
</listitem><listitem><para><computeroutput>void *&amp;device_data</computeroutput></para>
<para>The generic pointer pointing to a copy of a local <computeroutput>struct</computeroutput> in a GPU device, provided in <computeroutput>ROCKY_PLUGIN_INITIALIZE_CUDA</computeroutput>. </para>
</listitem></itemizedlist>
</para>
</sect3>
</sect2>
    </detaileddescription>
    <location file="docs/sdk_manual/solver_hooks.md"/>
  </compounddef>
</doxygen>
