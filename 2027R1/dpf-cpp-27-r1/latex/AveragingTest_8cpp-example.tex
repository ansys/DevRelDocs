\doxysection{Averaging\+Test.\+cpp}
\hypertarget{AveragingTest_8cpp-example}{}\label{AveragingTest_8cpp-example}Examples showing how to average results to reach a nodal or elemental form, per bodies...


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//}}
\DoxyCodeLine{\textcolor{comment}{//\ COPYRIGHT\ ANSYS.\ ALL\ RIGHTS\ RESERVED.}}
\DoxyCodeLine{\textcolor{comment}{//}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}dpf\_api.h"{}}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ EXAMPLE}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}Example.h"{}}}
\DoxyCodeLine{\textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <gtest/gtest.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Averaging,\ ResultsRequestedLocation)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ The\ location\ is\ the\ type\ of\ topology\ associated\ with\ the\ data\ container.\ }}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ For\ finite\ element\ data,\ the\ location\ is\ one\ of\ three\ spatial\ locations:\ Nodal,\ Elemental,\ or\ ElementalNodal.}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ For\ more\ information\ about\ the\ location,\ see\ https://dpf.docs.pyansys.com/version/stable/concepts/concepts.html\#location.}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ }}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ When\ reading\ a\ result,\ a\ specific\ location\ can\ be\ requested.\ }}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ The\ following\ example\ illustrates\ how\ to\ request\ a\ Nodal\ location\ for\ a\ result\ with\ an\ ElementalNodal\ native\ location.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Data\ source}}
\DoxyCodeLine{\ \ \ \ std::string\ fileName(\textcolor{stringliteral}{"{}../../../testfiles/mapdl\_files/TwoSolids.rst"{}});}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1DataSources}{ansys::dpf::DataSources}}\ dataSources;}
\DoxyCodeLine{\ \ \ \ dataSources.\doxymbox{\hyperlink{classansys_1_1dpf_1_1DataSources_ad2a5bb6f24ca621ffaaee9e7a47cdc20}{addResultFile}}(fileName);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}\ stress\_op(\textcolor{stringliteral}{"{}S"{}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (stress\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1DpfTypes_a39cd546c42518e2332be8f287db95459}{empty}}())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}S\ operator\ failed\ to\ load"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1a5b6613f802062fde4faea4b553db7fbc}{ansys::dpf::eDataSourcesPin}},\ dataSources);}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldsContainer}{ansys::dpf::FieldsContainer}}\ result\_fc\ =\ stress\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator_a9994ffe0f23c4a5de614099abb95286c}{getOutputFieldsContainer}}(0);}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(std::string(result\_fc.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldsContainer_addfee935e69fe9fb9e0e533449f9a5bc}{at}}(0).\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a860e65caa16f612746ad116429282fd3}{fieldDefinition}}().\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a9ea61f23ef1eb93c794b7c222d7740b8}{location}}().\doxymbox{\hyperlink{structansys_1_1dpf_1_1Location_ad9fab192124627740ffa623b1a0221ea}{c\_str}}()),\ std::string(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_a0bda534055805adc4c08bece34989ff3}{ansys::dpf::locations::elemental\_nodal}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1aa8522e00b69f3a2f2626a088f20823fe}{ansys::dpf::eLocationPin}},\ std::string(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_aa4e1967b0838d8597200c606c8564d29}{ansys::dpf::locations::nodal}}.c\_str()));}
\DoxyCodeLine{\ \ \ \ result\_fc\ =\ stress\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator_a9994ffe0f23c4a5de614099abb95286c}{getOutputFieldsContainer}}(0);}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(std::string(result\_fc.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldsContainer_addfee935e69fe9fb9e0e533449f9a5bc}{at}}(0).\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a860e65caa16f612746ad116429282fd3}{fieldDefinition}}().\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a9ea61f23ef1eb93c794b7c222d7740b8}{location}}().\doxymbox{\hyperlink{structansys_1_1dpf_1_1Location_ad9fab192124627740ffa623b1a0221ea}{c\_str}}()),\ std::string(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_aa4e1967b0838d8597200c606c8564d29}{ansys::dpf::locations::nodal}}.c\_str()));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1aa8522e00b69f3a2f2626a088f20823fe}{ansys::dpf::eLocationPin}},\ std::string(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_a3f66169a86ab935fb398b3fdde98bb04}{ansys::dpf::locations::elemental}}.c\_str()));}
\DoxyCodeLine{\ \ \ \ result\_fc\ =\ stress\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator_a9994ffe0f23c4a5de614099abb95286c}{getOutputFieldsContainer}}(0);}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(std::string(result\_fc.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldsContainer_addfee935e69fe9fb9e0e533449f9a5bc}{at}}(0).\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a860e65caa16f612746ad116429282fd3}{fieldDefinition}}().\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a9ea61f23ef1eb93c794b7c222d7740b8}{location}}().\doxymbox{\hyperlink{structansys_1_1dpf_1_1Location_ad9fab192124627740ffa623b1a0221ea}{c\_str}}()),\ std::string(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_a3f66169a86ab935fb398b3fdde98bb04}{ansys::dpf::locations::elemental}}.c\_str()));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(Averaging,\ B867395\_no\_crash\_with\_empty\_element\_list)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1MeshedRegion}{ansys::dpf::MeshedRegion}}\ m;}
\DoxyCodeLine{\ \ \ \ m.\doxymbox{\hyperlink{classansys_1_1dpf_1_1MeshedRegion_a2b4891674d74a792b63318c305963500}{addNode}}(1,\ \{\ 0.0,0.0,0.0\ \});}
\DoxyCodeLine{\ \ \ \ m.\doxymbox{\hyperlink{classansys_1_1dpf_1_1MeshedRegion_a2b4891674d74a792b63318c305963500}{addNode}}(2,\ \{\ 1.0,0.0,0.0\ \});}
\DoxyCodeLine{\ \ \ \ m.\doxymbox{\hyperlink{classansys_1_1dpf_1_1MeshedRegion_a2b4891674d74a792b63318c305963500}{addNode}}(3,\ \{\ 0.0,1.0,0.0\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Field}{ansys::dpf::Field}}\ nodal\_field;}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition}{ansys::dpf::FieldDefinition}}\ fdef;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ fdef.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a5ef8fa0b594db3066e6aab50d3b019b6}{setLocation}}(\doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_aa4e1967b0838d8597200c606c8564d29}{ansys::dpf::locations::nodal}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ fdef.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a0d33e4d4faaa30b3808014b19de680cd}{dimensions}}()\ =\ \{\ 1\ \};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ fdef.\doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldDefinition_a8033b1d4486ea3d819ecbb6418bab079}{setUnit}}(\doxymbox{\hyperlink{classansys_1_1dpf_1_1Unit}{ansys::dpf::Unit}}(\textcolor{stringliteral}{"{}m"{}}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nodal\_field.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a471c3f541458acc9c05dfb019a99abb3}{setFieldDefinition}}(fdef);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nodal\_field.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a5b717ed309ddf287134905f71ada833b}{push\_back}}(1,\ \{\ 1.0\ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nodal\_field.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a5b717ed309ddf287134905f71ada833b}{push\_back}}(2,\ \{\ 2.0\ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nodal\_field.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_a5b717ed309ddf287134905f71ada833b}{push\_back}}(3,\ \{\ 3.0\ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nodal\_field.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Field_ab71f825765a7ce1b37373443917ec23e}{setSupport}}(m);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}\ averager(\textcolor{stringliteral}{"{}nodal\_to\_elemental"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ averager.connect(0,\ nodal\_field);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ out\ =\ averager.getOutputField(0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(out.dataSize(),\ 0);}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST(AveragingPerBody,\ Nodal)}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ The\ following\ example\ shows\ you\ how\ to\ average\ a\ result\ per\ body\ for\ a\ multibody\ simulation.\ }}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Data\ source}}
\DoxyCodeLine{\ \ \ \ std::string\ fileName(\textcolor{stringliteral}{"{}../../../testfiles/mapdl\_files/TwoSolids.rst"{}});}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1DataSources}{ansys::dpf::DataSources}}\ dataSources;}
\DoxyCodeLine{\ \ \ \ dataSources.\doxymbox{\hyperlink{classansys_1_1dpf_1_1DataSources_ad2a5bb6f24ca621ffaaee9e7a47cdc20}{addResultFile}}(fileName);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Get\ scoping\ split\ by\ body}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Instantiate\ MeshProvider\ operator\ to\ get\ the\ MeshedRegion}}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}\ meshProvider\ =\ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}(\textcolor{stringliteral}{"{}MeshProvider"{}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (meshProvider.\doxymbox{\hyperlink{classansys_1_1dpf_1_1DpfTypes_a39cd546c42518e2332be8f287db95459}{empty}}())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}MeshProvider\ failed\ to\ load"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ meshProvider.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1a5b6613f802062fde4faea4b553db7fbc}{ansys::dpf::eDataSourcesPin}},\ dataSources);}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1MeshedRegion}{ansys::dpf::MeshedRegion}}\ mesh\ =\ meshProvider.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator_ae67b9230160d80fbca07eb423f180f98}{getOutputMeshedRegion}}(0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Instantiate\ the\ scoping::by\_property\ operator\ that\ provides\ a\ ScopingsContainer\ }}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ containing\ a\ scoping\ per\ body}}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}\ scoping\_op\ =\ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}(\textcolor{stringliteral}{"{}scoping::by\_property"{}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (scoping\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1DpfTypes_a39cd546c42518e2332be8f287db95459}{empty}}())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}scoping::by\_property\ operator\ failed\ to\ load"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ scoping\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1a88b6b8d0c02d2ac48fc40e8c02e3da7c}{ansys::dpf::eMeshRegionPin}},\ mesh);}
\DoxyCodeLine{\ \ \ \ scoping\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1aa8522e00b69f3a2f2626a088f20823fe}{ansys::dpf::eLocationPin}},\ \doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_a3f66169a86ab935fb398b3fdde98bb04}{ansys::dpf::locations::elemental}});}
\DoxyCodeLine{\ \ \ \ scoping\_op.connect(13,\ std::string(\textcolor{stringliteral}{"{}mat"{}}));\ \textcolor{comment}{//\ split\ per\ body\ with\ mat\ attribute}}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1ScopingsContainer}{ansys::dpf::ScopingsContainer}}\ scopings\_per\_body\ =\ scoping\_op.\doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator_ab8effed66eaf13176c6d68eb3fd2c11f}{getOutputScopingsContainer}}(0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(scopings\_per\_body.size(),\ 4);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Get\ split\ result}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Instantiate\ the\ result\ operator\ (stress)}}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1Operator}{ansys::dpf::Operator}}\ stress\_op(\textcolor{stringliteral}{"{}S"{}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (stress\_op.empty())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}S\ operator\ failed\ to\ load"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Connect\ the\ DataSources}}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1a5b6613f802062fde4faea4b553db7fbc}{ansys::dpf::eDataSourcesPin}},\ dataSources);}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Request\ a\ location\ for\ the\ output}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Stress\ result\ from\ TwoSolids.rst\ file\ has\ native\ ElementalNodal\ location}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ An\ average\ from\ ElementalNodal\ to\ Nodal\ location\ will\ be\ done}}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1aa8522e00b69f3a2f2626a088f20823fe}{ansys::dpf::eLocationPin}},\ \doxymbox{\hyperlink{structansys_1_1dpf_1_1locations_aa4e1967b0838d8597200c606c8564d29}{ansys::dpf::locations::nodal}});}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Provide\ the\ ScopingsContainer\ (containing\ a\ scoping\ per\ body)\ as\ input\ to\ the\ operator}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ The\ resulting\ FieldsContainer\ will\ contain\ a\ Field\ per\ body}}
\DoxyCodeLine{\ \ \ \ stress\_op.connect(\doxymbox{\hyperlink{namespaceansys_1_1dpf_aa4a44a04a0aafb8fe0645f019bbd94d1a79a70f074b2f79ccaff75ae8e4ec9ec9}{ansys::dpf::eMeshScopPin}},\ scopings\_per\_body);}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Compute\ output\ FieldsContainer}}
\DoxyCodeLine{\ \ \ \ \doxymbox{\hyperlink{classansys_1_1dpf_1_1FieldsContainer}{ansys::dpf::FieldsContainer}}\ result\_fc\ =\ stress\_op.getOutputFieldsContainer(0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ EXPECT\_EQ(result\_fc.size(),\ 4);}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 