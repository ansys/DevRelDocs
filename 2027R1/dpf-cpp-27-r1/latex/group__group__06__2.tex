\doxysubsection{Creating a DPF custom operator\textquotesingle{}s library }
\hypertarget{group__group__06__2}{}\label{group__group__06__2}\index{Creating a DPF custom operator\textquotesingle{}s library@{Creating a DPF custom operator\textquotesingle{}s library}}
The Data Processing Framework (DPF) provides numerical simulation users/\+engineers with a toolbox for accessing and transforming simulation data. It is used to handle complex pre-\/ or post-\/processing of simulation data within a simulation workflow.

In DPF, {\bfseries{Operators}} are the main object used to create, transform and stream the data. An operator is composed of a “core” that handles the calculation. It receives the data using input pins, applies a transformation and makes the data available through the output pins (think of an integrated circuit in electronics). See the \doxylink{group__group__02}{Concepts and Terminology} to learn more.

In Ansys 2022 R2 and later, you can create custom operator\textquotesingle{}s libraries in C++. It enables to access custom capabilities in any project that is using DPF.

This guide explains how to {\bfseries{create and compile an operator\textquotesingle{}s library C++ project}}, and {\bfseries{how to consume it in another C++ project}}.\hypertarget{group__group__06__2_autotoc_md45}{}\doxysubsubsubsection{\texorpdfstring{Pre-\/requisites}{Pre-\/requisites}}\label{group__group__06__2_autotoc_md45}
In order to use DPF in a C++ project, it is required to have access to the following files of the \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+AWP\+\_\+\+ROOT@doc\+\_\+ansys\+\_\+ver/\+dpf/\+include\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} folder (AWP\+\_\+\+ROOT@doc\+\_\+ansys\+\_\+ver being an environment variable defining the root of the Ansys Inc or \href{https://dpf.docs.pyansys.com/version/stable/getting_started/dpf_server.html}{\texttt{DPF Server}} product):\+
\begin{DoxyItemize}
\item dpf\+\_\+api.\+h
\item dpf\+\_\+api\+\_\+i.\+cpp
\end{DoxyItemize}

{\bfseries{DPF\+\_\+\+HGP\+\_\+\+ROOT environment variable}} must be set to define the location of those files and {\bfseries{must be set to follow this tutorial}}.

Here is the command for Windows:\+ @win\+\_\+set\+\_\+hgp\+\_\+root

It can also be set by editing the environment variables in Windows settings.

Here is the command for Linux:\+ @lin\+\_\+set\+\_\+hgp\+\_\+root

Moreover it is needed to have compilation tools. Both CMake and Visual Studio are supported for project management and compilation. Examples using both are provided in the following sections.

Create a {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}}. The following sections of this tutorial are performed from this folder.\hypertarget{group__group__06__2_autotoc_md46}{}\doxysubsubsubsection{\texorpdfstring{Create a C++ Custom operator\textquotesingle{}s library}{Create a C++ Custom operator\textquotesingle{}s library}}\label{group__group__06__2_autotoc_md46}
This section details the C++ code to create a custom basic operator\textquotesingle{}s library.

In the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}} previously created, create a {\bfseries{My\+Custom\+Operator.\+h}} file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\#pragma\ once}
\DoxyCodeLine{}
\DoxyCodeLine{\#include\ "{}dpf\_api.h"{}}
\DoxyCodeLine{}
\DoxyCodeLine{\#ifndef\ \_\_linux\_\_}
\DoxyCodeLine{\#define\ CLAYER\_DLLEXPORT\ \_\_declspec(dllexport)}
\DoxyCodeLine{\#else}
\DoxyCodeLine{\#define\ CLAYER\_DLLEXPORT\ \_\_attribute\_\_\ ((visibility\ ("{}default"{})))}
\DoxyCodeLine{\#endif}
\DoxyCodeLine{}
\DoxyCodeLine{namespace\ custom\_operators}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ //\ DPF\ initial\ settings:\ once\ by\ project}
\DoxyCodeLine{\ \ \ \ //\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{\ \ struct\ staticData\ \{}
\DoxyCodeLine{\ \ \ \ \ \ static\ ansys::dpf::LibraryHandle*\ \_dpfLibraryHandle;}
\DoxyCodeLine{\ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ extern\ "{}C"{}\ CLAYER\_DLLEXPORT\ int\ LoadOperators(ansys::dpf::AbstractCore*\ core\_ptr);}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ my\ custom\ operator\ }
\DoxyCodeLine{\ \ \ \ //\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{\ \ \ \ struct\ CustomMessage}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ identify\ the\ operator}
\DoxyCodeLine{\ \ \ \ \ \ \ \ static\ std::string\ name()\ \{\ return\ "{}custom\_message"{};\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ describe\ the\ operator\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ static\ ansys::dpf::OperatorSpecification\ specification()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ansys::dpf::OperatorSpecification\ spec;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ spec.setDocumentation("{}This\ operator\ displays\ a\ custom\ message\ in\ the\ output\ console."{});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ spec.setInputPins(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ansys::dpf::PinDefinition(0)\ //\ set\ the\ input\ pin\ number}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setName("{}custom\_message"{})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setAcceptedTypes(\{\ ansys::dpf::types::string\})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setDoc("{}Custom\ message\ to\ display\ in\ the\ output\ console"{}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ //\ set\ the\ exposed\ properties\ of\ the\ operator,\ allowing\ documentation\ generation\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ spec.setProperty(ansys::dpf::spec::exposure::sExposure,\ ansys::dpf::spec::exposure::sPublic);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ spec.setProperty(ansys::dpf::spec::category::sCategory,\ "{}custom"{});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ spec.setProperty(ansys::dpf::spec::sUserName,\ "{}custom\ message"{});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ return\ spec;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ define\ the\ data\ computation}
\DoxyCodeLine{\ \ \ \ \ \ \ \ static\ void\ run(ansys::dpf::OperatorMain\&\ main);}
\DoxyCodeLine{\ \ \ \ \};}
\DoxyCodeLine{\}}

\end{DoxyCode}


The {\bfseries{static\+Data}} structure allows to use the DPF capabilities and must be incorporated only once per project. The {\bfseries{Custom\+Message}} structure contains all the implementation related to the custom operator. It always contains:\+
\begin{DoxyItemize}
\item a {\bfseries{name}} method (unique identifier)
\item a {\bfseries{specification}} method which defines and describes the operator inputs, outputs and data computation
\item a {\bfseries{run}} method which contains the data computation code
\end{DoxyItemize}

In the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}}, create a {\bfseries{My\+Custom\+Operator.\+cpp}} file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\#include\ "{}MyCustomOperator.h"{}}
\DoxyCodeLine{}
\DoxyCodeLine{\#include\ "{}dpf\_api\_i.cpp"{}}
\DoxyCodeLine{}
\DoxyCodeLine{namespace\ custom\_operators}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ ansys::dpf::LibraryHandle*\ staticData::\_dpfLibraryHandle\ =\ new\ ansys::dpf::LibraryHandle();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ extern\ "{}C"{}\ CLAYER\_DLLEXPORT\ int\ LoadOperators(ansys::dpf::AbstractCore*\ core\_ptr)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ansys::dpf::core::recordOperatorAtCore<CustomMessage>(core\_ptr);\ //\ record\ the\ operator\ to\ make\ it\ accessible}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ 0;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ void\ CustomMessage::run(ansys::dpf::OperatorMain\&\ main)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ get\ the\ input\ data}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::string\ to\_display\ =\ main.getInputString(0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ computes\ the\ data}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::cout\ <<\ "{}Hello\ world!\ This\ message\ is\ displayed\ from\ a\ DPF\ operator."{}\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::cout\ <<\ to\_display.c\_str()\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ Set\ the\ final\ state\ of\ the\ operator}
\DoxyCodeLine{\ \ \ \ \ \ \ \ main.setSuccessed();\ }
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


It is now required to compile the code.\hypertarget{group__group__06__2_autotoc_md47}{}\doxysubsubsubsection{\texorpdfstring{Compile the C++ Custom operator\textquotesingle{}s library}{Compile the C++ Custom operator\textquotesingle{}s library}}\label{group__group__06__2_autotoc_md47}
This sections details the compilation process of the C++ code.\hypertarget{group__group__06__2_autotoc_md48}{}\doxysubsubsubsubsection{\texorpdfstring{Using Visual Studio (Windows only)}{Using Visual Studio (Windows only)}}\label{group__group__06__2_autotoc_md48}
In the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}} previously created, create a {\bfseries{Custom\+Operators.\+vcxproj}} file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{<?xml\ version="{}1.0"{}\ encoding="{}utf-\/8"{}?>}
\DoxyCodeLine{<Project\ DefaultTargets="{}Build"{}\ xmlns="{}http://schemas.microsoft.com/developer/msbuild/2003"{}>}
\DoxyCodeLine{\ \ <ItemGroup\ Label="{}ProjectConfigurations"{}>}
\DoxyCodeLine{\ \ \ \ <ProjectConfiguration\ Include="{}Release|x64"{}>}
\DoxyCodeLine{\ \ \ \ \ \ <Configuration>Release</Configuration>}
\DoxyCodeLine{\ \ \ \ \ \ <Platform>x64</Platform>}
\DoxyCodeLine{\ \ \ \ </ProjectConfiguration>}
\DoxyCodeLine{\ \ </ItemGroup>}
\DoxyCodeLine{\ \ <ItemGroup>}
\DoxyCodeLine{\ \ \ \ <ClInclude\ Include="{}.\(\backslash\)MyCustomOperator.h"{}\ />}
\DoxyCodeLine{\ \ </ItemGroup>}
\DoxyCodeLine{\ \ <ItemGroup>}
\DoxyCodeLine{\ \ \ \ <ClCompile\ Include="{}.\(\backslash\)MyCustomOperator.cpp"{}\ />}
\DoxyCodeLine{\ \ </ItemGroup>}
\DoxyCodeLine{\ \ <PropertyGroup\ Label="{}Globals"{}>}
\DoxyCodeLine{\ \ \ \ <VCProjectVersion>17.0</VCProjectVersion>}
\DoxyCodeLine{\ \ \ \ <ProjectGuid>\{18ED472A-\/4ECB-\/498C-\/A66C-\/805668FAABD3\}</ProjectGuid>}
\DoxyCodeLine{\ \ \ \ <Keyword>Win32Proj</Keyword>}
\DoxyCodeLine{\ \ \ \ <RootNamespace>CustomOperators</RootNamespace>}
\DoxyCodeLine{\ \ \ \ <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.Default.props"{}\ />}
\DoxyCodeLine{\ \ <PropertyGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}\ Label="{}Configuration"{}>}
\DoxyCodeLine{\ \ \ \ <ConfigurationType>DynamicLibrary</ConfigurationType>}
\DoxyCodeLine{\ \ \ \ <UseDebugLibraries>false</UseDebugLibraries>}
\DoxyCodeLine{\ \ \ \ <PlatformToolset>v143</PlatformToolset>}
\DoxyCodeLine{\ \ \ \ <WholeProgramOptimization>true</WholeProgramOptimization>}
\DoxyCodeLine{\ \ \ \ <CharacterSet>Unicode</CharacterSet>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.props"{}\ />}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}ExtensionSettings"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}Shared"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}PropertySheets"{}\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <Import\ Project="{}\$(UserRootDir)\(\backslash\)Microsoft.Cpp.\$(Platform).user.props"{}\ Condition="{}exists('\$(UserRootDir)\(\backslash\)Microsoft.Cpp.\$(Platform).user.props')"{}\ Label="{}LocalAppDataPlatform"{}\ />}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <PropertyGroup\ Label="{}UserMacros"{}\ />}
\DoxyCodeLine{\ \ <PropertyGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <LinkIncremental>false</LinkIncremental>}
\DoxyCodeLine{\ \ \ \ <OutDir>\$(SolutionDir)build\(\backslash\)\$(Configuration)\(\backslash\)</OutDir>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <ItemDefinitionGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <ClCompile>}
\DoxyCodeLine{\ \ \ \ \ \ <PrecompiledHeader>NotUsing</PrecompiledHeader>}
\DoxyCodeLine{\ \ \ \ \ \ <WarningLevel>Level3</WarningLevel>}
\DoxyCodeLine{\ \ \ \ \ \ <Optimization>MaxSpeed</Optimization>}
\DoxyCodeLine{\ \ \ \ \ \ <FunctionLevelLinking>true</FunctionLevelLinking>}
\DoxyCodeLine{\ \ \ \ \ \ <IntrinsicFunctions>true</IntrinsicFunctions>}
\DoxyCodeLine{\ \ \ \ \ \ <SDLCheck>true</SDLCheck>}
\DoxyCodeLine{\ \ \ \ \ \ <PreprocessorDefinitions>NDEBUG;\_CONSOLE;\%(PreprocessorDefinitions)</PreprocessorDefinitions>}
\DoxyCodeLine{\ \ \ \ \ \ <ConformanceMode>true</ConformanceMode>}
\DoxyCodeLine{\ \ \ \ \ \ <AdditionalIncludeDirectories>\$(DPF\_HGP\_ROOT);\%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>}
\DoxyCodeLine{\ \ \ \ </ClCompile>}
\DoxyCodeLine{\ \ \ \ <Link>}
\DoxyCodeLine{\ \ \ \ \ \ <SubSystem>Console</SubSystem>}
\DoxyCodeLine{\ \ \ \ \ \ <EnableCOMDATFolding>true</EnableCOMDATFolding>}
\DoxyCodeLine{\ \ \ \ \ \ <OptimizeReferences>true</OptimizeReferences>}
\DoxyCodeLine{\ \ \ \ \ \ <GenerateDebugInformation>true</GenerateDebugInformation>}
\DoxyCodeLine{\ \ \ \ </Link>}
\DoxyCodeLine{\ \ </ItemDefinitionGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.targets"{}\ />}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}ExtensionTargets"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{</Project>}

\end{DoxyCode}


Then, open the {\bfseries{My\+Custom\+Operator.\+vcxproj project}} in Visual Studio and compile it.\hypertarget{group__group__06__2_autotoc_md49}{}\doxysubsubsubsubsection{\texorpdfstring{Using CMake (Windows and Linux)}{Using CMake (Windows and Linux)}}\label{group__group__06__2_autotoc_md49}
In the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}} previously created, create a CMake\+Lists.\+txt file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{set(CMAKE\_VERBOSE\_MAKEFILE\ ON)}
\DoxyCodeLine{cmake\_minimum\_required(VERSION\ 3.16.3)}
\DoxyCodeLine{project(CustomOperators)}
\DoxyCodeLine{}
\DoxyCodeLine{if(NOT\ DEFINED\ ENV\{DPF\_HGP\_ROOT\})}
\DoxyCodeLine{\ \ \ \ message(FATAL\_ERROR\ "{}DPF\_HGP\_ROOT\ not\ found!"{})}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Compiler\ options}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{if\ (NOT\ MSVC)}
\DoxyCodeLine{\ \ \ \ set(CMAKE\_CXX\_FLAGS\ \ \ \ \ \ \ \ \ "{}-\/Wall\ -\/Wextra\ -\/Wconversion"{})}
\DoxyCodeLine{\ \ \ \ set(CMAKE\_CXX\_FLAGS\ "{}\$\{CMAKE\_CXX\_FLAGS\}\ -\/fvisibility=hidden"{})}
\DoxyCodeLine{\ \ set(CMAKE\_SHARED\_LINKER\_FLAGS\ "{}-\/fvisibility=hidden"{})}
\DoxyCodeLine{else()}
\DoxyCodeLine{\ \ \ \ set(CMAKE\_CXX\_FLAGS\ \ \ \ \ \ \ \ \ "{}/W3\ /sdl\ /EHsc"{})}
\DoxyCodeLine{\ \ \ \ set(CMAKE\_CXX\_FLAGS\_RELEASE\ "{}/O2\ /Oi\ /Gy"{})}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Dependencies}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{include\_directories(\$ENV\{DPF\_HGP\_ROOT\})}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Add\ library}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{file(GLOB\ SOURCE\_FILES\ *.cpp)}
\DoxyCodeLine{}
\DoxyCodeLine{add\_library(\$\{CMAKE\_PROJECT\_NAME\}\ SHARED\ \$\{SOURCE\_FILES\})}

\end{DoxyCode}


Then, run the following commands in a {\bfseries{command line}} opened from the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build}
\DoxyCodeLine{cd\ build}
\DoxyCodeLine{cmake\ ..\ -\/DCMAKE\_BUILD\_TYPE=Release\ }
\DoxyCodeLine{cmake\ -\/-\/build\ .\ -\/-\/config\ Release}

\end{DoxyCode}


On Windows, it creates a {\bfseries{build/\+\+Release}} folder which contains the "{}\+Custom\+Operators.\+dll"{}. On Linux, it creates the "{}lib\+Custom\+Operators.\+so"{} file into the {\bfseries{build}} folder.\hypertarget{group__group__06__2_autotoc_md50}{}\doxysubsubsubsection{\texorpdfstring{Create an application that consumes the C++ Custom operator\textquotesingle{}s library}{Create an application that consumes the C++ Custom operator\textquotesingle{}s library}}\label{group__group__06__2_autotoc_md50}
The following shows how to consume the Custom\+Operators binary into another C++ project. The consumption is done by loading the binary in the new C++ project at runtime.\hypertarget{group__group__06__2_autotoc_md51}{}\doxysubsubsubsubsection{\texorpdfstring{Create the testing files}{Create the testing files}}\label{group__group__06__2_autotoc_md51}
Set a {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators environment variable}} to the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}}.

In the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}} previously created, create a {\bfseries{DPF\+\_\+application}} folder.

In the {\bfseries{DPF\+\_\+application}} folder, create a Custom\+Operators\+Test.\+cpp with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{\#include\ "{}dpf\_api.h"{}}
\DoxyCodeLine{\#include\ "{}dpf\_api\_i.cpp"{}}
\DoxyCodeLine{}
\DoxyCodeLine{int\ main(int\ argc,\ char**\ argv)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ //\ Initialize\ DPF\ }
\DoxyCodeLine{\ \ \ \ ansys::dpf::LibraryHandle*\ lib\ =\ new\ ansys::dpf::LibraryHandle();}
\DoxyCodeLine{\ \ \ \ ansys::dpf::DpfError\ libDpfError\ =\ lib-\/>error();}
\DoxyCodeLine{\ \ \ \ if(!libDpfError.isOk())}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::cout\ <<\ "{}DPF\ initialization\ failed."{}\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::string\ error\_message\ =\ libDpfError.message();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (!error\_message.empty())}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ error\_message.c\_str()\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ 1;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ //\ Load\ the\ DPF\ Custom\ operator's\ library\ to\ access\ the\ "{}custom\_message"{}}
\DoxyCodeLine{\ \ \ \ const\ char*\ val\ =\ getenv("{}DPF\_Custom\_Operators"{});}
\DoxyCodeLine{\ \ \ \ if\ (!val)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::cout\ <<\ "{}DPF\_Custom\_Operators\ environment\ variable\ not\ found!"{}\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ 1;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \#ifdef\ \_\_linux\_\_}
\DoxyCodeLine{\ \ std::string\ path\_to\_dll\ =\ std::string(val)\ +\ "{}/build/libCustomOperators.so"{};}
\DoxyCodeLine{\ \ \#else}
\DoxyCodeLine{\ \ \ \ std::string\ path\_to\_dll\ =\ std::string(val)\ +\ "{}/build/Release/CustomOperators.dll"{};}
\DoxyCodeLine{\ \ \#endif}
\DoxyCodeLine{\ \ \ \ ansys::dpf::core::loadDpfPlugin(path\_to\_dll,\ "{}custom\_operators"{});}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ //\ use\ the\ Custom\ Operator}
\DoxyCodeLine{\ \ \ \ ansys::dpf::Operator\ custom\_operator("{}custom\_message"{});}
\DoxyCodeLine{\ \ \ \ if\ (custom\_operator.empty())}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::cout\ <<\ "{}CustomOperators\ load\ failed."{}\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ 1;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ std::string\ custom\_message\_str\ =\ "{}This\ is\ a\ DPF\ custom\ message."{};}
\DoxyCodeLine{\ \ \ \ custom\_operator.connect(0,\ custom\_message\_str);\ }
\DoxyCodeLine{\ \ \ \ custom\_operator.run();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ delete\ lib;}
\DoxyCodeLine{\ \ \ \ return\ 0;}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{group__group__06__2_autotoc_md52}{}\doxysubsubsubsubsection{\texorpdfstring{Compile the test application}{Compile the test application}}\label{group__group__06__2_autotoc_md52}
\hypertarget{group__group__06__2_autotoc_md53}{}\doxysubsubsubsubsubsection{\texorpdfstring{With CMake (Windows and Linux)}{With CMake (Windows and Linux)}}\label{group__group__06__2_autotoc_md53}
In the {\bfseries{DPF\+\_\+application}} folder, create a CMake\+Lists.\+txt file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{set(CMAKE\_VERBOSE\_MAKEFILE\ ON)}
\DoxyCodeLine{cmake\_minimum\_required(VERSION\ 3.16.3)}
\DoxyCodeLine{project(CustomOperatorsTest)}
\DoxyCodeLine{}
\DoxyCodeLine{if(NOT\ DEFINED\ ENV\{DPF\_HGP\_ROOT\})}
\DoxyCodeLine{\ \ \ \ message(FATAL\_ERROR\ "{}DPF\_HGP\_ROOT\ not\ found!"{})}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{if(NOT\ DEFINED\ ENV\{DPF\_Custom\_Operators\})}
\DoxyCodeLine{\ \ \ \ message(FATAL\_ERROR\ "{}DPF\_Custom\_Operators\ not\ found!"{})}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Compiler\ options}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{if\ (NOT\ MSVC)}
\DoxyCodeLine{\ \ set(CMAKE\_CXX\_FLAGS\ \ "{}-\/ldl\ -\/Wall\ -\/Wextra\ -\/Wconversion"{})}
\DoxyCodeLine{\ \ \ \ add\_definitions(-\/D\_CRT\_SECURE\_NO\_WARNINGS)}
\DoxyCodeLine{else()}
\DoxyCodeLine{\ \ \ \ add\_definitions(-\/D\_CRT\_SECURE\_NO\_WARNINGS)}
\DoxyCodeLine{endif()}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Dependencies}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{include\_directories(\$ENV\{DPF\_HGP\_ROOT\})}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Add\ library}
\DoxyCodeLine{\#-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{file(GLOB\ SOURCE\_FILES\ *.cpp)}
\DoxyCodeLine{}
\DoxyCodeLine{add\_executable(\$\{PROJECT\_NAME\}\ \$\{SOURCE\_FILES\})}

\end{DoxyCode}


Run the following commands in a {\bfseries{command line}} opened from the {\bfseries{DPF\+\_\+application folder}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build}
\DoxyCodeLine{cd\ build}
\DoxyCodeLine{cmake\ ..\ -\/DCMAKE\_BUILD\_TYPE=Release\ }
\DoxyCodeLine{cmake\ -\/-\/build\ .\ -\/-\/config\ Release}

\end{DoxyCode}
\hypertarget{group__group__06__2_autotoc_md54}{}\doxysubsubsubsubsubsection{\texorpdfstring{With Visual Studio (Windows only)}{With Visual Studio (Windows only)}}\label{group__group__06__2_autotoc_md54}
In the {\bfseries{DPF\+\_\+application}} folder, create a {\bfseries{Custom\+Operators\+Test.\+vcxproj}} file with the following content:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{<?xml\ version="{}1.0"{}\ encoding="{}utf-\/8"{}?>}
\DoxyCodeLine{<Project\ DefaultTargets="{}Build"{}\ xmlns="{}http://schemas.microsoft.com/developer/msbuild/2003"{}>}
\DoxyCodeLine{\ \ <ItemGroup\ Label="{}ProjectConfigurations"{}>}
\DoxyCodeLine{\ \ \ \ <ProjectConfiguration\ Include="{}Release|x64"{}>}
\DoxyCodeLine{\ \ \ \ \ \ <Configuration>Release</Configuration>}
\DoxyCodeLine{\ \ \ \ \ \ <Platform>x64</Platform>}
\DoxyCodeLine{\ \ \ \ </ProjectConfiguration>}
\DoxyCodeLine{\ \ </ItemGroup>}
\DoxyCodeLine{\ \ <ItemGroup>}
\DoxyCodeLine{\ \ \ \ <ClCompile\ Include="{}.\(\backslash\)CustomOperatorsTest.cpp"{}\ />}
\DoxyCodeLine{\ \ </ItemGroup>}
\DoxyCodeLine{\ \ <PropertyGroup\ Label="{}Globals"{}>}
\DoxyCodeLine{\ \ \ \ <VCProjectVersion>17.0</VCProjectVersion>}
\DoxyCodeLine{\ \ \ \ <ProjectGuid>\{129D604D-\/EF32-\/4091-\/ABAD-\/BF3622AF6F08\}</ProjectGuid>}
\DoxyCodeLine{\ \ \ \ <Keyword>Win32Proj</Keyword>}
\DoxyCodeLine{\ \ \ \ <RootNamespace>CustomOperatorsTest</RootNamespace>}
\DoxyCodeLine{\ \ \ \ <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.Default.props"{}\ />}
\DoxyCodeLine{\ \ <PropertyGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}\ Label="{}Configuration"{}>}
\DoxyCodeLine{\ \ \ \ <ConfigurationType>Application</ConfigurationType>}
\DoxyCodeLine{\ \ \ \ <UseDebugLibraries>false</UseDebugLibraries>}
\DoxyCodeLine{\ \ \ \ <PlatformToolset>v143</PlatformToolset>}
\DoxyCodeLine{\ \ \ \ <WholeProgramOptimization>true</WholeProgramOptimization>}
\DoxyCodeLine{\ \ \ \ <CharacterSet>Unicode</CharacterSet>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.props"{}\ />}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}ExtensionSettings"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}Shared"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}PropertySheets"{}\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <Import\ Project="{}\$(UserRootDir)\(\backslash\)Microsoft.Cpp.\$(Platform).user.props"{}\ Condition="{}exists('\$(UserRootDir)\(\backslash\)Microsoft.Cpp.\$(Platform).user.props')"{}\ Label="{}LocalAppDataPlatform"{}\ />}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{\ \ <PropertyGroup\ Label="{}UserMacros"{}\ />}
\DoxyCodeLine{\ \ <PropertyGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <LinkIncremental>false</LinkIncremental>}
\DoxyCodeLine{\ \ </PropertyGroup>}
\DoxyCodeLine{\ \ <ItemDefinitionGroup\ Condition="{}'\$(Configuration)|\$(Platform)'=='Release|x64'"{}>}
\DoxyCodeLine{\ \ \ \ <ClCompile>}
\DoxyCodeLine{\ \ \ \ \ \ <PrecompiledHeader>}
\DoxyCodeLine{\ \ \ \ \ \ </PrecompiledHeader>}
\DoxyCodeLine{\ \ \ \ \ \ <WarningLevel>Level3</WarningLevel>}
\DoxyCodeLine{\ \ \ \ \ \ <Optimization>MaxSpeed</Optimization>}
\DoxyCodeLine{\ \ \ \ \ \ <FunctionLevelLinking>true</FunctionLevelLinking>}
\DoxyCodeLine{\ \ \ \ \ \ <IntrinsicFunctions>true</IntrinsicFunctions>}
\DoxyCodeLine{\ \ \ \ \ \ <SDLCheck>true</SDLCheck>}
\DoxyCodeLine{\ \ \ \ \ \ <PreprocessorDefinitions>NDEBUG;\_CONSOLE;\_CRT\_SECURE\_NO\_WARNINGS;\%(PreprocessorDefinitions)</PreprocessorDefinitions>}
\DoxyCodeLine{\ \ \ \ \ \ <ConformanceMode>true</ConformanceMode>}
\DoxyCodeLine{\ \ \ \ \ \ <AdditionalIncludeDirectories>\$(DPF\_HGP\_ROOT);\%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>}
\DoxyCodeLine{\ \ \ \ </ClCompile>}
\DoxyCodeLine{\ \ \ \ <Link>}
\DoxyCodeLine{\ \ \ \ \ \ <SubSystem>Console</SubSystem>}
\DoxyCodeLine{\ \ \ \ \ \ <EnableCOMDATFolding>true</EnableCOMDATFolding>}
\DoxyCodeLine{\ \ \ \ \ \ <OptimizeReferences>true</OptimizeReferences>}
\DoxyCodeLine{\ \ \ \ \ \ <GenerateDebugInformation>true</GenerateDebugInformation>}
\DoxyCodeLine{\ \ \ \ </Link>}
\DoxyCodeLine{\ \ </ItemDefinitionGroup>}
\DoxyCodeLine{\ \ <Import\ Project="{}\$(VCTargetsPath)\(\backslash\)Microsoft.Cpp.targets"{}\ />}
\DoxyCodeLine{\ \ <ImportGroup\ Label="{}ExtensionTargets"{}>}
\DoxyCodeLine{\ \ </ImportGroup>}
\DoxyCodeLine{</Project>}

\end{DoxyCode}
\hypertarget{group__group__06__2_autotoc_md55}{}\doxysubsubsubsubsection{\texorpdfstring{Run the test application}{Run the test application}}\label{group__group__06__2_autotoc_md55}
\hypertarget{group__group__06__2_autotoc_md56}{}\doxysubsubsubsubsubsection{\texorpdfstring{With CMake}{With CMake}}\label{group__group__06__2_autotoc_md56}
Run the following command in a {\bfseries{command line}} opened from the {\bfseries{DPF\+\_\+application folder}}.

On Windows, use the following:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{set\ PATH=\%AWP\_ROOT271\%/aisol/bin/winx64;\%PATH\%}
\DoxyCodeLine{cd\ build}
\DoxyCodeLine{cd\ Release}
\DoxyCodeLine{CustomOperatorsTest.exe}

\end{DoxyCode}


Setting the PATH is required to find DPF entry point (Data\+Processing\+Core.\+dll).

On Linux, use the following:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{export\ LD\_LIBRARY\_PATH=\$\{AWP\_ROOT271\}/aisol/dll/linx64"{};\$\{LD\_LIBRARY\_PATH\}}
\DoxyCodeLine{cd\ build}
\DoxyCodeLine{./CustomOperatorsTest}

\end{DoxyCode}


Setting the LD\+\_\+\+LIBRARY\+\_\+\+PATH is required to find DPF entry point (lib\+Data\+Processing\+Core.\+so).

If you face licensing issues, the ANSYSLMD\+\_\+\+LICENSE\+\_\+\+FILE might must be set. Refer to the \href{https://dpf.docs.pyansys.com/version/stable/user_guide/getting_started_with_dpf_server.html\#license-terms}{\texttt{License terms section}} to learn how to set it.\hypertarget{group__group__06__2_autotoc_md57}{}\doxysubsubsubsubsubsection{\texorpdfstring{With Visual Studio}{With Visual Studio}}\label{group__group__06__2_autotoc_md57}
Edit your environment variables and update the PATH value inserting a "{}\%\+AWP\+\_\+\+ROOT@doc\+\_\+ansys\+\_\+ver\%/\+aisol/\+bin/\+winx64"{} field. It is needed that the application can find DPF entry point (Data\+Processing\+Core.\+dll) while running. Edit your environment variables and create a DPF\+\_\+\+Custom\+\_\+\+Operators variable that targets the {\bfseries{DPF\+\_\+\+Custom\+\_\+\+Operators folder}} location. Open the {\bfseries{Custom\+Operators\+Test.\+vcxproj project}} in Visual Studio. Compile it. Press F5 to run the code.\hypertarget{group__group__06__2_autotoc_md58}{}\doxysubsubsubsubsubsection{\texorpdfstring{Result}{Result}}\label{group__group__06__2_autotoc_md58}
The following message should appear:\+


\begin{DoxyCode}{0}
\DoxyCodeLine{Hello\ world!\ This\ message\ is\ displayed\ from\ a\ DPF\ operator.}
\DoxyCodeLine{This\ is\ a\ DPF\ custom\ message.}

\end{DoxyCode}
 